<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RC Crawler Gear Ratio Calculator</title>
    <meta name="description" content="Professional RC crawler gear ratio calculator with speed calculations">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-brand">
                <img src="images/ydrRC_Logo.png" 
                     alt="ydrRC Logo" 
                     class="brand-logo"
                     onerror="this.style.display='none'">
                <div class="header-text">
                    <h1>Crawler Gear Ratio Calculator</h1>
                    <p>Calculate gear ratios and theoretical speeds for your RC crawler</p>
                </div>
            </div>
        </header>
        
        <main class="content">
            <section class="input-section">
                <h2>Input Parameters</h2>
                
                <div class="input-group">
                    <label for="pinion">Pinion Gear Tooth Count:</label>
                    <input type="number" id="pinion" value="13" min="8" max="30" required>
                </div>
                
                <div class="input-group">
                    <label for="spur">Spur Gear Tooth Count:</label>
                    <input type="number" id="spur" value="56" min="20" max="100" required>
                </div>
                
                <div class="input-group">
                    <label for="transmission">Transmission:</label>
                    <select id="transmission" required>
                        <option value="">Select Transmission...</option>
                    </select>
                    <div class="checkbox-group">
                        <input type="checkbox" id="reverseTransmission">
                        <label for="reverseTransmission">Reverse Transmission Ratio</label>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="frontAxle">Front Axle:</label>
                    <select id="frontAxle" required>
                        <option value="">Select Front Axle...</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="rearAxle">Rear Axle:</label>
                    <select id="rearAxle" required>
                        <option value="">Select Rear Axle...</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="motorKV">Motor KV Value:</label>
                    <input type="number" id="motorKV" value="1800" min="100" max="5000">
                </div>
                
                <div class="input-group">
                    <label>Max Battery Voltage:</label>
                    <div class="voltage-group">
                        <select id="voltagePreset">
                            <option value="">Select Preset or Enter Custom...</option>
                            <option value="8.4">8.4V (2S)</option>
                            <option value="12.6" selected>12.6V (3S)</option>
                            <option value="16.8">16.8V (4S)</option>
                            <option value="21.0">21.0V (5S)</option>
                            <option value="25.2">25.2V (6S)</option>
                        </select>
                        <input type="number" id="maxVoltage" value="12.6" step="0.1" min="3" max="30" placeholder="Custom voltage" disabled style="background-color: #e9ecef; cursor: not-allowed;">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Tire Size:</label>
                    <div class="tire-size-group">
                        <input type="number" id="tireSize" value="4.75" step="0.01" min="2" max="6">
                        <select id="tireSizeUnit">
                            <option value="inches">inches</option>
                            <option value="mm">mm</option>
                        </select>
                    </div>
                </div>
                
                <div class="import-export-buttons">
                    <button type="button" id="exportBtn" class="action-btn">Export Configuration</button>
                    <label for="importFile" class="action-btn">Import Configuration</label>
                    <input type="file" id="importFile" accept=".txt,.asc" style="display: none;">
                </div>
            </section>
            
            <section class="results-section">
                <h2>Calculation Results</h2>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Motor Gear Ratio</h3>
                    <div class="value" id="motorRatio">4.308:1</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Transmission Ratio</h3>
                    <div class="value" id="transmissionRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Front Axle Ratio</h3>
                    <div class="value" id="frontAxleRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Rear Axle Ratio</h3>
                    <div class="value" id="rearAxleRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Final Front Ratio</h3>
                    <div class="value" id="frontRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Final Rear Ratio</h3>
                    <div class="value" id="rearRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Overdrive Percentage</h3>
                    <div class="value" id="overdrivePercentage">-</div>
                </div>
                
                <div class="speed-results">
                    <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                        <h3>Approx. Front Speed</h3>
                        <div class="value" id="frontSpeed">-</div>
                    </div>
                    
                    <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                        <h3>Approx. Rear Speed</h3>
                        <div class="value" id="rearSpeed">-</div>
                    </div>
                </div>
            </section>
        </main>
        
        <section class="notes-section">
            <h2>Notes</h2>
            <div class="notes-content">
                <p class="first-note">Many thanks to Travis Miller (<a href="https://www.facebook.com/TravyM" target="_blank">https://www.facebook.com/TravyM</a>) who originally created this sheet. I've put a lot of time into updating it and I hope it works for everyone. I also want to thank Mehmet Tuzel (<a href="https://www.facebook.com/tuzelm" target="_blank">https://www.facebook.com/tuzelm</a>) for all his help in double checking my work and many suggestions on axles and transmissions to add to the list.</p>
                
                <p>Some transmissions do not require a spur and have one built in. In these cases, there will be a description of the built in spur after the transmission name. You'll need to select this spur from the spur list to get correct calculations.</p>
                
                <p>For AR44 based axles, the OD1 = 27/8 gearing and OD2 = 24/8 gearing available from Boom Racing (<a href="https://www.boomracingrc.com" target="_blank">https://www.boomracingrc.com</a>) and Team Ottsix Racing (<a href="https://www.ottsix.com" target="_blank">https://www.ottsix.com</a>).</p>
                
                <p>The numbers in () after the axle names represent the portal gear sizes. They are lots of options for Capra/AR45P axles and a couple for Vanquish portals.</p>
                
                <p>You can manually override the Pinion, Spur, and Tire Size values. There are too many options to maintain a complete list.</p>
                
                <p>Please let me know of any other axles and transmissions that can be added. I know there are more, but I couldn't find info on some.</p>
                
                <p>Overdrive % numbers may not match what you are expecting as many suppliers/manufacturers do not calculate this value correctly. This sheet uses the Percent Difference Formula (<a href="https://www.omnicalculator.com/math/percentage-difference" target="_blank">https://www.omnicalculator.com/math/percentage-difference</a>).</p>
                
                <p>If your overdrive % is a negative number, your rear axle will be faster than the front. This is usually not the desired setup.</p>
                
                <p>If you are running a straight axle in the front and a portal axle in the rear, you may choose to mount your transmission with OD to the rear. To enable this, just check the reverse box under the transmission drop-down.</p>
                
                <p>If you have any questions, issues, or suggestions, please contact me at <a href="mailto:jeff@ydrRC.com">jeff@ydrRC.com</a></p>
            </div>
        </section>
        
        <footer class="footer">
            <img src="images/ydrRC_Logo.png" 
                 alt="ydrRC Logo" 
                 class="footer-logo"
                 onerror="this.style.display='none'">
            <p>&copy; 2025 <span class="ydrrc-text"></span> Crawler Calculator. Licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" style="color: white; text-decoration: underline;">CC BY-NC-SA 4.0</a></p>
        </footer>
    </div>

    <!-- JavaScript Files -->
    <script src="js/data.js"></script>
    <script>
        /**
         * RC Crawler Calculator - Calculation Engine
         * Handles all gear ratio and speed calculations
         */

        class CrawlerCalculator {
            constructor() {
                this.results = {
                    motorRatio: 0,
                    finalFrontRatio: 0,
                    finalRearRatio: 0,
                    frontSpeed: 0,
                    rearSpeed: 0,
                    overdrivePercentage: 0
                };
            }

            /**
             * Calculate motor gear ratio
             * @param {number} spurTeeth - Number of spur gear teeth
             * @param {number} pinionTeeth - Number of pinion gear teeth
             * @returns {number} Motor gear ratio
             */
            calculateMotorRatio(spurTeeth, pinionTeeth) {
                if (!spurTeeth || !pinionTeeth || pinionTeeth === 0) {
                    return 0;
                }
                return spurTeeth / pinionTeeth;
            }

            /**
             * Calculate overdrive percentage using percent difference formula
             * @param {number} frontRatio - Front axle final ratio
             * @param {number} rearRatio - Rear axle final ratio
             * @returns {number} Overdrive percentage
             */
            calculateOverdrivePercentage(frontRatio, rearRatio) {
                console.log('Calculating overdrive:', { frontRatio, rearRatio });
                
                if (!frontRatio || !rearRatio || frontRatio === 0 || rearRatio === 0) {
                    console.log('Invalid ratios for overdrive calculation');
                    return 0;
                }
                
                // Percent difference formula: ((rear - front) / average) * 100
                // where average = (rear + front) / 2
                const average = (rearRatio + frontRatio) / 2;
                const result = ((rearRatio - frontRatio) / average) * 100;
                
                console.log('Overdrive calculation result:', result);
                return result;
            }

            /**
             * Calculate final drive ratios
             * @param {Object} params - Calculation parameters
             */
            calculateRatios(params) {
                const {
                    spurTeeth,
                    pinionTeeth,
                    transmissionName,
                    frontAxleName,
                    rearAxleName,
                    reverseTransmission = false
                } = params;

                // Calculate motor ratio
                const motorRatio = this.calculateMotorRatio(spurTeeth, pinionTeeth);
                this.results.motorRatio = motorRatio;

                // Get transmission and axle data
                const transmission = getTransmission(transmissionName);
                const frontAxleRatio = getAxle(frontAxleName);
                const rearAxleRatio = getAxle(rearAxleName);

                if (!transmission || frontAxleRatio === null || rearAxleRatio === null) {
                    this.results.finalFrontRatio = 0;
                    this.results.finalRearRatio = 0;
                    this.results.overdrivePercentage = 0;
                    return this.results;
                }

                // Apply reverse transmission logic
                const frontTransRatio = reverseTransmission ? transmission.rear : transmission.front;
                const rearTransRatio = reverseTransmission ? transmission.front : transmission.rear;

                // Calculate final ratios
                this.results.finalFrontRatio = motorRatio * frontTransRatio * frontAxleRatio;
                this.results.finalRearRatio = motorRatio * rearTransRatio * rearAxleRatio;

                // Calculate overdrive percentage
                this.results.overdrivePercentage = this.calculateOverdrivePercentage(
                    this.results.finalFrontRatio, 
                    this.results.finalRearRatio
                );

                return this.results;
            }

            /**
             * Calculate theoretical speeds
             */
            calculateSpeeds(params) {
                const {
                    motorKV,
                    maxVoltage,
                    tireSize,
                    tireSizeUnit = 'inches'
                } = params;

                // Validate inputs
                if (!motorKV || !maxVoltage || !tireSize || 
                    !this.results.finalFrontRatio || !this.results.finalRearRatio) {
                    this.results.frontSpeed = 0;
                    this.results.rearSpeed = 0;
                    return this.results;
                }

                // Convert tire size to inches if needed
                const tireSizeInches = tireSizeUnit === 'mm' ? tireSize / 25.4 : tireSize;
                const tireCircumference = Math.PI * tireSizeInches;

                // Calculate motor RPM
                const motorRPM = motorKV * maxVoltage;

                // Calculate wheel RPM
                const frontWheelRPM = motorRPM / this.results.finalFrontRatio;
                const rearWheelRPM = motorRPM / this.results.finalRearRatio;

                // Calculate speeds in MPH
                const frontSpeedMPH = (frontWheelRPM * tireCircumference * 60) / (12 * 5280);
                const rearSpeedMPH = (rearWheelRPM * tireCircumference * 60) / (12 * 5280);

                this.results.frontSpeed = frontSpeedMPH;
                this.results.rearSpeed = rearSpeedMPH;

                return this.results;
            }

            /**
             * Calculate all parameters at once
             */
            calculateAll(params) {
                this.calculateRatios(params);
                this.calculateSpeeds(params);
                return this.results;
            }

            /**
             * Get formatted results for display
             */
            getFormattedResults() {
                return {
                    motorRatio: this.formatRatio(this.results.motorRatio),
                    finalFrontRatio: this.formatRatio(this.results.finalFrontRatio),
                    finalRearRatio: this.formatRatio(this.results.finalRearRatio),
                    frontSpeed: this.formatSpeed(this.results.frontSpeed),
                    rearSpeed: this.formatSpeed(this.results.rearSpeed),
                    overdrivePercentage: this.formatPercentage(this.results.overdrivePercentage)
                };
            }

            formatRatio(ratio) {
                if (!ratio || ratio === 0) return '-';
                return `${ratio.toFixed(3)}:1`;
            }

            formatSpeed(speed) {
                if (!speed || speed === 0) return '-';
                return `${speed.toFixed(2)} MPH`;
            }

            formatPercentage(percentage) {
                console.log('Formatting percentage:', percentage);
                if (percentage === null || percentage === undefined || !isFinite(percentage)) return '-';
                const sign = percentage > 0 ? '+' : '';
                const result = `${sign}${percentage.toFixed(1)}%`;
                console.log('Formatted percentage result:', result);
                return result;
            }
        }

        // Create global calculator instance
        const calculator = new CrawlerCalculator();
        
        function calculate() {
            console.log('Using UPDATED calculate function with overdrive support!');
            try {
                const params = {
                    spurTeeth: parseFloat(document.getElementById('spur').value) || 0,
                    pinionTeeth: parseFloat(document.getElementById('pinion').value) || 0,
                    transmissionName: document.getElementById('transmission').value,
                    frontAxleName: document.getElementById('frontAxle').value,
                    rearAxleName: document.getElementById('rearAxle').value,
                    reverseTransmission: document.getElementById('reverseTransmission').checked,
                    motorKV: parseFloat(document.getElementById('motorKV').value) || 0,
                    maxVoltage: parseFloat(document.getElementById('maxVoltage').value) || 0,
                    tireSize: parseFloat(document.getElementById('tireSize').value) || 0,
                    tireSizeUnit: document.getElementById('tireSizeUnit').value
                };
                
                const results = calculator.calculateAll(params);
                const formatted = calculator.getFormattedResults();
                
                console.log('Calculator results:', results);
                console.log('Formatted results:', formatted);
                
                // Get individual component ratios
                const transmission = getTransmission(params.transmissionName);
                const frontAxleRatio = getAxle(params.frontAxleName);
                const rearAxleRatio = getAxle(params.rearAxleName);
                
                // Update all result displays
                const motorRatioEl = document.getElementById('motorRatio');
                const transmissionRatioEl = document.getElementById('transmissionRatio');
                const frontAxleRatioEl = document.getElementById('frontAxleRatio');
                const rearAxleRatioEl = document.getElementById('rearAxleRatio');
                const frontRatioEl = document.getElementById('frontRatio');
                const rearRatioEl = document.getElementById('rearRatio');
                const overdrivePercentageEl = document.getElementById('overdrivePercentage');
                const frontSpeedEl = document.getElementById('frontSpeed');
                const rearSpeedEl = document.getElementById('rearSpeed');
                
                if (motorRatioEl) motorRatioEl.textContent = formatted.motorRatio;
                
                // Display transmission ratios
                if (transmissionRatioEl && transmission) {
                    const frontTransRatio = params.reverseTransmission ? transmission.rear : transmission.front;
                    const rearTransRatio = params.reverseTransmission ? transmission.front : transmission.rear;
                    
                    if (frontTransRatio === rearTransRatio) {
                        transmissionRatioEl.textContent = `${frontTransRatio.toFixed(3)}:1`;
                    } else {
                        transmissionRatioEl.textContent = `F:${frontTransRatio.toFixed(3)} R:${rearTransRatio.toFixed(3)}`;
                    }
                } else if (transmissionRatioEl) {
                    transmissionRatioEl.textContent = '-';
                }
                
                // Display axle ratios
                if (frontAxleRatioEl) {
                    frontAxleRatioEl.textContent = frontAxleRatio ? `${frontAxleRatio.toFixed(3)}:1` : '-';
                }
                if (rearAxleRatioEl) {
                    rearAxleRatioEl.textContent = rearAxleRatio ? `${rearAxleRatio.toFixed(3)}:1` : '-';
                }
                
                // Display final ratios and speeds
                if (frontRatioEl) frontRatioEl.textContent = formatted.finalFrontRatio;
                if (rearRatioEl) rearRatioEl.textContent = formatted.finalRearRatio;
                if (overdrivePercentageEl) {
                    console.log('Setting overdrive element to:', formatted.overdrivePercentage);
                    overdrivePercentageEl.textContent = formatted.overdrivePercentage;
                    console.log('Overdrive element content after setting:', overdrivePercentageEl.textContent);
                } else {
                    console.log('ERROR: Overdrive element not found! Looking for id="overdrivePercentage"');
                }
                if (frontSpeedEl) frontSpeedEl.textContent = formatted.frontSpeed;
                if (rearSpeedEl) rearSpeedEl.textContent = formatted.rearSpeed;
                
            } catch (error) {
                console.error('Calculation error:', error);
            }
        }

        let debounceTimer = null;
        function debounceCalculate() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(calculate, 300);
        }

        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, starting initialization...');
            
            // Populate dropdowns
            populateTransmissions();
            populateAxles();
            
            // Add event listeners
            addEventListeners();
            
            // Set defaults after dropdowns are populated
            setDefaults();
            
            // Initial calculation
            calculate();
            
            console.log('Initialization complete');
        });

        function populateTransmissions() {
            const select = document.getElementById('transmission');
            if (!select) {
                console.error('Transmission select not found');
                return;
            }
            
            console.log('Populating transmissions...');
            const transmissions = getTransmissionNames();
            
            transmissions.forEach(transmission => {
                const option = document.createElement('option');
                option.value = transmission;
                option.textContent = transmission;
                select.appendChild(option);
            });
            
            console.log(`Added ${transmissions.length} transmissions`);
        }

        function populateAxles() {
            const frontSelect = document.getElementById('frontAxle');
            const rearSelect = document.getElementById('rearAxle');
            
            if (!frontSelect || !rearSelect) {
                console.error('Axle selects not found');
                return;
            }
            
            console.log('Populating axles...');
            const axles = getAxleNames();
            
            axles.forEach(axle => {
                const frontOption = document.createElement('option');
                frontOption.value = axle;
                frontOption.textContent = axle;
                frontSelect.appendChild(frontOption);
                
                const rearOption = document.createElement('option');
                rearOption.value = axle;
                rearOption.textContent = axle;
                rearSelect.appendChild(rearOption);
            });
            
            console.log(`Added ${axles.length} axles`);
        }

        function setDefaults() {
            console.log('Setting default values...');
            
            // Set default transmission
            const transmissionEl = document.getElementById('transmission');
            if (transmissionEl) {
                transmissionEl.value = 'Axial 3-Gear';
                console.log('Set default transmission: Axial 3-Gear');
            }
            
            // Set default front axle
            const frontAxleEl = document.getElementById('frontAxle');
            if (frontAxleEl) {
                frontAxleEl.value = 'AR44 / AR45 / SCX Pro / Element';
                console.log('Set default front axle: AR44 / AR45 / SCX Pro / Element');
            }
            
            // Set default rear axle
            const rearAxleEl = document.getElementById('rearAxle');
            if (rearAxleEl) {
                rearAxleEl.value = 'AR44 / AR45 / SCX Pro / Element';
                console.log('Set default rear axle: AR44 / AR45 / SCX Pro / Element');
            }
            
            console.log('Default values set');
        }

        function addEventListeners() {
            console.log('Adding event listeners...');
            
            // Basic inputs
            const inputs = ['pinion', 'spur', 'transmission', 'frontAxle', 'rearAxle', 'reverseTransmission', 'motorKV', 'maxVoltage', 'tireSize', 'tireSizeUnit'];
            
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', calculate);
                    element.addEventListener('input', debounceCalculate);
                    console.log(`Added listeners to ${id}`);
                } else {
                    console.warn(`Element ${id} not found`);
                }
            });
            
            // Special handler for transmission changes (spur gear auto-fill)
            const transmissionEl = document.getElementById('transmission');
            if (transmissionEl) {
                transmissionEl.addEventListener('change', handleTransmissionChange);
                console.log('Added transmission change handler');
            }
        }

        function handleTransmissionChange() {
            const transmissionEl = document.getElementById('transmission');
            const spurEl = document.getElementById('spur');
            
            if (!transmissionEl || !spurEl) return;
            
            const transmissionName = transmissionEl.value;
            console.log('Transmission changed to:', transmissionName);
            
            if (transmissionName && transmissionName.toLowerCase().includes('spur')) {
                const spurCount = extractSpurGearCount(transmissionName);
                console.log('Extracted spur count:', spurCount);
                
                if (spurCount) {
                    spurEl.value = spurCount;
                    spurEl.disabled = true;
                    spurEl.style.backgroundColor = '#e9ecef';
                    spurEl.style.cursor = 'not-allowed';
                    
                    // Update label to show it's auto-filled
                    const spurLabel = document.querySelector('label[for="spur"]');
                    if (spurLabel && !spurLabel.textContent.includes('(Auto)')) {
                        spurLabel.textContent = spurLabel.textContent.replace(':', ' (Auto):');
                    }
                    
                    console.log('Spur gear auto-set to:', spurCount);
                }
            } else {
                // Re-enable spur input for non-spur transmissions
                spurEl.disabled = false;
                spurEl.style.backgroundColor = 'white';
                spurEl.style.cursor = 'text';
                
                // Remove auto label
                const spurLabel = document.querySelector('label[for="spur"]');
                if (spurLabel && spurLabel.textContent.includes('(Auto)')) {
                    spurLabel.textContent = spurLabel.textContent.replace(' (Auto)', '');
                }
                
                console.log('Spur gear input re-enabled');
            }
            
            // Trigger calculation after transmission change
            calculate();
        }

        function extractSpurGearCount(transmissionName) {
            // Look for pattern: number followed by parenthesis, followed by "spur" (case insensitive)
            // Examples:
            // "Axial Capra UTB18 40 (48) Spur" -> should extract 40
            // "Dlux Cheez Berger 17% OD - 48(48) Spur" -> should extract 48
            
            const spurRegex = /(\d+)\s*\([^)]*\)\s*spur/i;
            const match = transmissionName.match(spurRegex);
            
            if (match && match[1]) {
                return parseInt(match[1], 10);
            }
            
            // Fallback: look for number immediately before "spur" (without parenthesis)
            const fallbackRegex = /(\d+)\s*spur/i;
            const fallbackMatch = transmissionName.match(fallbackRegex);
            
            if (fallbackMatch && fallbackMatch[1]) {
                return parseInt(fallbackMatch[1], 10);
            }
            
            return null;
        }
        
        
        
        function calculate() {
            console.log('Using UPDATED calculate function with overdrive support!');
            try {
                const params = {
                    spurTeeth: parseFloat(document.getElementById('spur').value) || 0,
                    pinionTeeth: parseFloat(document.getElementById('pinion').value) || 0,
                    transmissionName: document.getElementById('transmission').value,
                    frontAxleName: document.getElementById('frontAxle').value,
                    rearAxleName: document.getElementById('rearAxle').value,
                    reverseTransmission: document.getElementById('reverseTransmission').checked,
                    motorKV: parseFloat(document.getElementById('motorKV').value) || 0,
                    maxVoltage: parseFloat(document.getElementById('maxVoltage').value) || 0,
                    tireSize: parseFloat(document.getElementById('tireSize').value) || 0,
                    tireSizeUnit: document.getElementById('tireSizeUnit').value
                };
                
                const results = calculator.calculateAll(params);
                const formatted = calculator.getFormattedResults();
                
                console.log('Calculator results:', results);
                console.log('Formatted results:', formatted);
                
                // Get individual component ratios
                const transmission = getTransmission(params.transmissionName);
                const frontAxleRatio = getAxle(params.frontAxleName);
                const rearAxleRatio = getAxle(params.rearAxleName);
                
                // Update all result displays
                const motorRatioEl = document.getElementById('motorRatio');
                const transmissionRatioEl = document.getElementById('transmissionRatio');
                const frontAxleRatioEl = document.getElementById('frontAxleRatio');
                const rearAxleRatioEl = document.getElementById('rearAxleRatio');
                const frontRatioEl = document.getElementById('frontRatio');
                const rearRatioEl = document.getElementById('rearRatio');
                const overdrivePercentageEl = document.getElementById('overdrivePercentage');
                const frontSpeedEl = document.getElementById('frontSpeed');
                const rearSpeedEl = document.getElementById('rearSpeed');
                
                if (motorRatioEl) motorRatioEl.textContent = formatted.motorRatio;
                
                // Display transmission ratios
                if (transmissionRatioEl && transmission) {
                    const frontTransRatio = params.reverseTransmission ? transmission.rear : transmission.front;
                    const rearTransRatio = params.reverseTransmission ? transmission.front : transmission.rear;
                    
                    if (frontTransRatio === rearTransRatio) {
                        transmissionRatioEl.textContent = `${frontTransRatio.toFixed(3)}:1`;
                    } else {
                        transmissionRatioEl.textContent = `F:${frontTransRatio.toFixed(3)} R:${rearTransRatio.toFixed(3)}`;
                    }
                } else if (transmissionRatioEl) {
                    transmissionRatioEl.textContent = '-';
                }
                
                // Display axle ratios
                if (frontAxleRatioEl) {
                    frontAxleRatioEl.textContent = frontAxleRatio ? `${frontAxleRatio.toFixed(3)}:1` : '-';
                }
                if (rearAxleRatioEl) {
                    rearAxleRatioEl.textContent = rearAxleRatio ? `${rearAxleRatio.toFixed(3)}:1` : '-';
                }
                
                // Display final ratios and speeds
                if (frontRatioEl) frontRatioEl.textContent = formatted.finalFrontRatio;
                if (rearRatioEl) rearRatioEl.textContent = formatted.finalRearRatio;
                if (overdrivePercentageEl) {
                    console.log('Setting overdrive element to:', formatted.overdrivePercentage);
                    overdrivePercentageEl.textContent = formatted.overdrivePercentage;
                    console.log('Overdrive element content after setting:', overdrivePercentageEl.textContent);
                } else {
                    console.log('ERROR: Overdrive element not found! Looking for id="overdrivePercentage"');
                }
                if (frontSpeedEl) frontSpeedEl.textContent = formatted.frontSpeed;
                if (rearSpeedEl) rearSpeedEl.textContent = formatted.rearSpeed;
                
            } catch (error) {
                console.error('Calculation error:', error);
            }
        }
    </script>
    <script>
        // Clipboard functionality for result items
        function copyToClipboard(element) {
            const valueElement = element.querySelector('.value');
            const titleElement = element.querySelector('h3');
            
            if (!valueElement || !titleElement) return;
            
            let value = valueElement.textContent.trim();
            const title = titleElement.textContent.trim();
            
            // Don't copy if value is empty or dash
            if (!value || value === '-') {
                showCopyFeedback(element, 'No value to copy', 'error');
                return;
            }
            
            // If it's a ratio (contains ":1"), only copy the number before ":1"
            if (value.includes(':1')) {
                value = value.split(':1')[0];
            } else {
                // For other values with text (like "8.45 MPH"), extract just the number
                const numberMatch = value.match(/[\d,.]+/);
                if (numberMatch) {
                    value = numberMatch[0];
                }
            }
            
            // Create the text to copy (just the numerical value)
            const textToCopy = value;
            
            // Try to copy to clipboard
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showCopyFeedback(element, 'Copied!', 'success');
                }).catch(() => {
                    fallbackCopyToClipboard(textToCopy, element);
                });
            } else {
                fallbackCopyToClipboard(textToCopy, element);
            }
        }
        
        // Fallback copy method for older browsers
        function fallbackCopyToClipboard(text, element) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopyFeedback(element, 'Copied!', 'success');
                } else {
                    showCopyFeedback(element, 'Copy failed', 'error');
                }
            } catch (err) {
                showCopyFeedback(element, 'Copy not supported', 'error');
            }
            
            document.body.removeChild(textArea);
        }
        
        // Show visual feedback when copying
        function showCopyFeedback(element, message, type) {
            // Add copied class for visual feedback
            element.classList.add('copied');
            
            // Create temporary feedback element
            const feedback = document.createElement('div');
            feedback.textContent = message;
            feedback.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: ${type === 'success' ? '#4CAF50' : '#f44336'};
                color: white;
                padding: 8px 16px;
                border-radius: 4px;
                font-size: 14px;
                font-weight: bold;
                z-index: 1000;
                pointer-events: none;
                animation: fadeInOut 1.5s ease-out forwards;
            `;
            
            // Add fade animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                    20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                }
            `;
            document.head.appendChild(style);
            
            // Position relative to the clicked element
            element.style.position = 'relative';
            element.appendChild(feedback);
            
            // Remove feedback and classes after animation
            setTimeout(() => {
                element.classList.remove('copied');
                if (feedback.parentNode) {
                    feedback.parentNode.removeChild(feedback);
                }
                document.head.removeChild(style);
            }, 1500);
        }
    </script>
</body>
</html>