<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RC Crawler Gear Ratio Calculator</title>
    <meta name="description" content="Professional RC crawler gear ratio calculator with speed calculations">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* RC Crawler Calculator Styles - ydrRC Theme */

        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        // Import functionality
        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) {
                console.log('No file selected');
                return;
            }
            
            console.log('Importing file:', file.name);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    console.log('File content loaded, length:', content.length);
                    
                    const config = parseImportContent(content);
                    console.log('Parsed config:', config);
                    
                    if (config && Object.keys(config).length > 0) {
                        applyImportedConfig(config);
                        showImportFeedback('Configuration imported successfully!', 'success');
                        
                        // Recalculate after a short delay to ensure DOM updates
                        setTimeout(() => {
                            calculate();
                        }, 200);
                    } else {
                        console.error('No valid config found');
                        showImportFeedback('Invalid configuration file format. Please check the file contains CONFIG_START and CONFIG_END markers.', 'error');
                    }
                } catch (error) {
                    console.error('Import error:', error);
                    showImportFeedback('Error reading configuration file: ' + error.message, 'error');
                }
                
                // Reset file input
                event.target.value = '';
            };
            
            reader.onerror = function() {
                console.error('File read error');
                showImportFeedback('Error reading file', 'error');
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }

        function parseImportContent(content) {
            try {
                // Look for CONFIG_START and CONFIG_END markers
                const startMarker = 'CONFIG_START';
                const endMarker = 'CONFIG_END';
                
                const startIndex = content.indexOf(startMarker);
                const endIndex = content.indexOf(endMarker);
                
                if (startIndex === -1 || endIndex === -1) {
                    console.warn('Config markers not found');
                    return null;
                }
                
                // Extract config section
                const configSection = content.substring(startIndex + startMarker.length, endIndex).trim();
                const lines = configSection.split('\n');
                
                const config = {};
                
                lines.forEach(line => {
                    line = line.trim();
                    if (line && line.includes('=')) {
                        const [key, value] = line.split('=');
                        if (key && value !== undefined) {
                            // Handle boolean values
                            if (value === 'true') {
                                config[key.trim()] = true;
                            } else if (value === 'false') {
                                config[key.trim()] = false;
                            } else {
                                config[key.trim()] = value;
                            }
                        }
                    }
                });
                
                return config;
            } catch (error) {
                console.error('Parse error:', error);
                return null;
            }
        }

        function applyImportedConfig(config) {
            try {
                console.log('Applying imported config:', config);
                
                // Apply values to form elements
                const setElementValue = (id, value) => {
                    const element = document.getElementById(id);
                    if (element && value !== undefined && value !== '') {
                        console.log(`Setting ${id} to ${value}`);
                        element.value = value;
                        
                        // Trigger change event to ensure any listeners are called
                        const event = new Event('change', { bubbles: true });
                        element.dispatchEvent(event);
                    } else {
                        console.log(`Could not set ${id} - element:`, element, 'value:', value);
                    }
                };
                
                const setElementChecked = (id, checked) => {
                    const element = document.getElementById(id);
                    if (element && checked !== undefined) {
                        console.log(`Setting ${id} checked to ${checked}`);
                        element.checked = checked;
                        
                        // Trigger change event
                        const event = new Event('change', { bubbles: true });
                        element.dispatchEvent(event);
                    }
                };
                
                // Set form values
                setElementValue('pinion', config.pinion);
                setElementValue('spur', config.spur);
                setElementValue('transmission', config.transmission);
                setElementValue('frontAxle', config.frontAxle);
                setElementValue('rearAxle', config.rearAxle);
                setElementChecked('reverseTransmission', config.reverseTransmission);
                setElementValue('motorKV', config.motorKV);
                setElementValue('tireSize', config.tireSize);
                setElementValue('tireSizeUnit', config.tireSizeUnit);
                
                // Handle voltage preset and max voltage
                setElementValue('voltagePreset', config.voltagePreset);
                setElementValue('maxVoltage', config.maxVoltage);
                
                // Handle voltage preset logic
                const voltagePresetEl = document.getElementById('voltagePreset');
                const maxVoltageEl = document.getElementById('maxVoltage');
                
                if (voltagePresetEl && maxVoltageEl) {
                    if (config.voltagePreset && config.voltagePreset !== '') {
                        maxVoltageEl.disabled = true;
                        maxVoltageEl.style.backgroundColor = '#e9ecef';
                        maxVoltageEl.style.cursor = 'not-allowed';
                    } else {
                        maxVoltageEl.disabled = false;
                        maxVoltageEl.style.backgroundColor = 'white';
                        maxVoltageEl.style.cursor = 'text';
                    }
                }
                
                console.log('Configuration applied successfully');
            } catch (error) {
                console.error('Apply config error:', error);
                throw error;
            }
        }

        function showImportFeedback(message, type) {
            // Create feedback element
            const feedback = document.createElement('div');
            feedback.textContent = message;
            feedback.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : '#f44336'};
                color: white;
                padding: 15px 20px;
                border-radius: 4px;
                font-size: 14px;
                font-weight: bold;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideInRight 0.3s ease-out;
            `;
            
            // Add animation keyframes
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(feedback);
            
            // Remove after 3 seconds
            setTimeout(() => {
                if (feedback.parentNode) {
                    feedback.parentNode.removeChild(feedback);
                }
                if (style.parentNode) {
                    style.parentNode.removeChild(style);
                }
            }, 3000);
        }

        body {
            font-family: 'Comfortaa', 'Arial', 'Helvetica', sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            color: #212529;
        }

        /* Container and Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 3px solid #000000;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ydrRC Brand Text Styling */
        .ydrrc-text {
            text-transform: none !important;
        }

        .ydrrc-text::before {
            content: "ydr";
            text-transform: lowercase;
        }

        .ydrrc-text::after {
            content: "RC";
            text-transform: uppercase;
        }

        /* Header Styles */
        .header {
            background: #000000;
            color: white;
            padding: 40px 30px;
            text-align: center;
            border-bottom: 3px solid #000000;
        }

        .header-brand {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .brand-logo {
            height: 80px;
            width: auto;
            max-width: 300px;
            object-fit: contain;
            transition: all 0.3s ease;
            background: white;
            padding: 10px;
            border: 2px solid #000000;
        }

        .brand-logo:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(255,255,255,0.3);
        }

        .header-text {
            flex: 1;
            min-width: 350px;
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 300;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.2em;
            font-weight: 300;
            letter-spacing: 1px;
        }

        /* Content Layout */
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            padding: 0;
        }

        /* Input Section */
        .input-section {
            background: #ffffff;
            padding: 40px;
            border-right: 3px solid #000000;
            transition: all 0.3s ease;
        }

        .input-section:hover {
            background: #f8f9fa;
        }

        .input-section h2 {
            color: #000000;
            margin-bottom: 30px;
            font-size: 1.8em;
            font-weight: 300;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 3px solid #000000;
            padding-bottom: 15px;
        }

        /* Import/Export Buttons */
        .import-export-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #000000;
        }

        .action-btn {
            background: #000000;
            color: white;
            border: 2px solid #000000;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Comfortaa', inherit;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .action-btn:hover {
            background: white;
            color: #000000;
            transform: translateY(-2px);
        }

        .action-btn:active {
            transform: translateY(0);
        }

        /* Input Groups */
        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #000000;
            transition: color 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9em;
        }

        .input-group:focus-within label {
            color: #495057;
        }

        .input-group select,
        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #000000;
            border-radius: 0;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            font-family: 'Comfortaa', inherit;
        }

        .input-group select:focus,
        .input-group input:focus {
            outline: none;
            border-color: #495057;
            background: #f8f9fa;
            transform: none;
        }

        .input-group select:hover,
        .input-group input:hover {
            border-color: #495057;
            background: #f8f9fa;
        }

        /* Disabled input styling */
        .input-group input:disabled {
            background-color: #e9ecef !important;
            color: #6c757d;
            cursor: not-allowed !important;
            border-color: #ced4da;
        }

        .input-group input:disabled:hover {
            background-color: #e9ecef !important;
            border-color: #ced4da;
        }

        /* Checkbox Group */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .checkbox-group:hover {
            background: transparent;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            transform: scale(1.3);
            cursor: pointer;
            accent-color: #000000;
        }

        .checkbox-group label {
            cursor: pointer;
            margin-bottom: 0;
            font-weight: 500;
        }

        /* Voltage Group */
        .voltage-group {
            display: flex;
            gap: 10px;
            align-items: stretch;
        }

        .voltage-group select {
            flex: 2;
        }

        .voltage-group input {
            flex: 1;
        }

        /* Tire Size Group */
        .tire-size-group {
            display: flex;
            gap: 10px;
            align-items: end;
        }

        .tire-size-group input {
            flex: 2;
        }

        .tire-size-group select {
            flex: 1;
        }

        /* Results Section */
        .results-section {
            background: #000000;
            color: white;
            padding: 40px;
            transition: all 0.3s ease;
            border: 3px solid #ffffff;
        }

        .results-section:hover {
            background: #212529;
        }

        .results-section h2 {
            margin-bottom: 30px;
            font-size: 1.8em;
            font-weight: 300;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 3px solid #ffffff;
            padding-bottom: 15px;
        }

        /* Result Items */
        .result-item {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border: 2px solid #ffffff;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .result-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }

        .result-item.clickable {
            cursor: pointer;
            user-select: none;
        }

        .result-item.clickable:hover {
            background: rgba(255,255,255,0.3);
            transform: translateX(5px) scale(1.02);
            box-shadow: 0 4px 12px rgba(255,255,255,0.2);
        }

        .result-item.clickable:active {
            transform: translateX(5px) scale(0.98);
        }

        .result-item.copied {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
            animation: copyFlash 0.6s ease-out;
        }

        @keyframes copyFlash {
            0% {
                background: rgba(76, 175, 80, 0.6);
                transform: translateX(5px) scale(1.05);
            }
            100% {
                background: rgba(76, 175, 80, 0.3);
                transform: translateX(5px) scale(1.02);
            }
        }

        .result-item h3 {
            font-size: 1.1em;
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
        }

        .result-item .value {
            font-size: 2.2em;
            font-weight: 300;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
        }

        /* Speed Results Grid */
        .speed-results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 25px;
        }

        /* Footer */
        .footer {
            background: #000000;
            color: white;
            text-align: center;
            padding: 25px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            border-top: 3px solid #000000;
        }

        .footer-logo {
            height: 80px;
            width: auto;
            transition: all 0.3s ease;
            filter: invert(1);
        }

        .footer-logo:hover {
            transform: scale(1.75);
        }

        .footer p {
            font-weight: 300;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* Notes Section */
        .notes-section {
            background: #f8f9fa;
            padding: 40px;
            border-top: 3px solid #000000;
            max-width: 1200px;
            margin: 0 auto;
        }

        .notes-section h2 {
            color: #000000;
            margin-bottom: 30px;
            font-size: 1.8em;
            font-weight: 300;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 3px solid #000000;
            padding-bottom: 15px;
            text-align: center;
        }

        .notes-content {
            line-height: 1.8;
            color: #2c3e50;
        }

        .notes-content p {
            margin-bottom: 20px;
            font-size: 1em;
            position: relative;
            padding-left: 30px;
        }

        .notes-content p::before {
            content: "âš™";
            position: absolute;
            left: 0;
            top: 0;
            color: #000000;
            font-size: 1.2em;
            font-weight: bold;
            animation: rotate 4s linear infinite;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .notes-content .first-note {
            color: #dc3545;
            font-weight: bold;
        }

        .notes-content .first-note::before {
            color: #000000;
        }

        .notes-content strong {
            color: #000000;
            font-weight: 600;
        }

        .notes-content a {
            color: #2c3e50;
            text-decoration: none;
            border-bottom: 1px solid #2c3e50;
            transition: all 0.3s ease;
        }

        .notes-content a:hover {
            color: #000000;
            border-bottom-color: #000000;
            background: rgba(0,0,0,0.05);
            padding: 2px 4px;
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .content {
                grid-template-columns: 1fr;
                gap: 0;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 3px solid #000000;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .header p {
                font-size: 1em;
            }
            
            .header-brand {
                flex-direction: column;
                gap: 20px;
            }
            
            .brand-logo {
                height: 60px;
            }
            
            .header-text {
                min-width: auto;
            }
            
            .input-section,
            .results-section {
                padding: 25px;
            }
            
            .speed-results {
                grid-template-columns: 1fr;
            }
            
            .result-item .value {
                font-size: 1.8em;
            }
            
            .notes-section {
                padding: 25px 15px;
            }
            
            .notes-content p {
                font-size: 0.9em;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 25px 15px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .tire-size-group,
            .voltage-group {
                flex-direction: column;
                gap: 10px;
            }
            
            .tire-size-group input,
            .tire-size-group select,
            .voltage-group input,
            .voltage-group select {
                flex: none;
            }
            
            .container {
                border-width: 2px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-brand">
                <a href="https://www.ydrRC.com" target="_blank">
                    <img src="images/ydrRC_Logo.png" 
                         alt="ydrRC Logo" 
                         class="brand-logo">
                </a>
                <div class="header-text">
                    <h1>Crawler Gear Ratio Calculator</h1>
                    <p>Calculate gear ratios and theoretical speeds for your RC crawler</p>
                </div>
            </div>
        </header>
        
        <main class="content">
            <section class="input-section">
                <h2>Input Parameters</h2>
                
                <div class="input-group">
                    <label for="pinion">Pinion Gear Tooth Count:</label>
                    <input type="number" id="pinion" value="13" min="8" max="30" required>
                </div>
                
                <div class="input-group">
                    <label for="spur">Spur Gear Tooth Count:</label>
                    <input type="number" id="spur" value="56" min="20" max="100" required>
                </div>
                
                <div class="input-group">
                    <label for="transmission">Transmission:</label>
                    <select id="transmission" required>
                        <option value="">Select Transmission...</option>
                    </select>
                    <div class="checkbox-group">
                        <input type="checkbox" id="reverseTransmission">
                        <label for="reverseTransmission">Reverse Transmission Ratio</label>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="frontAxle">Front Axle:</label>
                    <select id="frontAxle" required>
                        <option value="">Select Front Axle...</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="rearAxle">Rear Axle:</label>
                    <select id="rearAxle" required>
                        <option value="">Select Rear Axle...</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="motorKV">Motor KV Value:</label>
                    <input type="number" id="motorKV" value="1800" min="100" max="5000">
                </div>
                
                <div class="input-group">
                    <label>Max Battery Voltage:</label>
                    <div class="voltage-group">
                        <select id="voltagePreset">
                            <option value="">Select Preset or Enter Custom...</option>
                            <option value="8.4">8.4V (2S)</option>
                            <option value="12.6" selected>12.6V (3S)</option>
                            <option value="16.8">16.8V (4S)</option>
                            <option value="21.0">21.0V (5S)</option>
                            <option value="25.2">25.2V (6S)</option>
                        </select>
                        <input type="number" id="maxVoltage" value="12.6" step="0.1" min="3" max="30" placeholder="Custom voltage" disabled style="background-color: #e9ecef; cursor: not-allowed;">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Tire Size:</label>
                    <div class="tire-size-group">
                        <input type="number" id="tireSize" value="4.75" step="0.01" min="2" max="6">
                        <select id="tireSizeUnit">
                            <option value="inches">inches</option>
                            <option value="mm">mm</option>
                        </select>
                    </div>
                </div>
                
                <div class="import-export-buttons">
                    <button type="button" id="exportBtn" class="action-btn">Export Configuration</button>
                    <label for="importFile" class="action-btn">Import Configuration</label>
                    <input type="file" id="importFile" accept=".txt,.asc" style="display: none;">
                </div>
            </section>
            
            <section class="results-section">
                <h2>Calculation Results</h2>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Motor Gear Ratio</h3>
                    <div class="value" id="motorRatio">4.308:1</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Transmission Ratio</h3>
                    <div class="value" id="transmissionRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Front Axle Ratio</h3>
                    <div class="value" id="frontAxleRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Rear Axle Ratio</h3>
                    <div class="value" id="rearAxleRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Final Front Ratio</h3>
                    <div class="value" id="frontRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Final Rear Ratio</h3>
                    <div class="value" id="rearRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Overdrive Percentage</h3>
                    <div class="value" id="overdrivePercentage">-</div>
                </div>
                
                <div class="speed-results">
                    <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                        <h3>Approx. Front Speed</h3>
                        <div class="value" id="frontSpeed">-</div>
                    </div>
                    
                    <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                        <h3>Approx. Rear Speed</h3>
                        <div class="value" id="rearSpeed">-</div>
                    </div>
                </div>
            </section>
        </main>
        
        <section class="notes-section">
            <h2>Notes</h2>
            <div class="notes-content">
                <p class="first-note">Many thanks to Travis Miller for originally creating this sheet. I've put a lot of time into updating it and I hope it works for everyone. I also want to thank Mehmet Tuzel for all his help in double checking my work and many suggestions on axles and transmissions to add to the list.</p>
                
                <p>Some transmissions do not require a spur and have one built in. In these cases, there will be a description of the built in spur after the transmission name. You'll need to select this spur from the spur list to get correct calculations.</p>
                
                <p>For AR44 based axles, the OD1 = 27/8 gearing and OD2 = 24/8 gearing available from Boom Racing and Team Ottsix Racing.</p>
                
                <p>The numbers in () after the axle names represent the portal gear sizes. They are lots of options for Capra/AR45P axles and a couple for Vanquish portals.</p>
                
                <p>You can manually override the Pinion, Spur, and Tire Size values. There are too many options to maintain a complete list.</p>
                
                <p>Please let me know of any other axles and transmissions that can be added. I know there are more, but I couldn't find info on some.</p>
                
                <p>Overdrive % numbers may not match what you are expecting as many suppliers/manufacturers do not calculate this value correctly. This sheet uses the Percent Difference Formula.</p>
                
                <p>If your overdrive % is a negative number, your rear axle will be faster than the front. This is usually not the desired setup.</p>
                
                <p>If you are running a straight axle in the front and a portal axle in the rear, you may choose to mount your transmission with OD to the rear. To enable this, just check the reverse box under the transmission drop-down.</p>
                
                <p>If you have any questions, issues, or suggestions, please contact me at jeff@ydrRC.com</p>
            </div>
        </section>
        
        <footer class="footer">
            <a href="https://www.ydrRC.com" target="_blank">
                <img src="images/YDR.png" 
                     alt="You're Damn Right Logo" 
                     class="footer-logo">
            </a>
            <p>&copy; 2025 <span class="ydrrc-text"></span> Crawler Calculator. Licensed under CC BY-NC-SA 4.0</p>
        </footer>
    </div>

    <script>
        // Transmission data with front and rear output ratios
        const TRANSMISSIONS = {
            "Axial 3-Gear": { front: 2.600, rear: 2.600 },
            "Axial Capra - 34(32) Spur": { front: 1.800, rear: 1.800 },
            "Axial Capra UTB18 40 (48) Spur": { front: 3.825, rear: 3.825 },
            "Axial Capra UTB18 [TGH] 42 (48) Spur": { front: 3.825, rear: 3.825 },
            "Axial LCXU (Basecamp) - Portal": { front: 1.643, rear: 1.643 },
            "Axial LCXU (Basecamp) - Straight": { front: 2.614, rear: 2.614 },
            "Axial SCX10 Pro - 0% OD": { front: 2.222, rear: 2.222 },
            "Axial SCX10 Pro - 40% OD": { front: 2.222, rear: 3.322 },
            "Axial SCX10.3 Portal high 40(32) Spur": { front: 1.520, rear: 1.520 },
            "Axial SCX10.3 Portal low 40(32) Spur": { front: 2.220, rear: 2.220 },
            "Axial SCX10.3 Straight high 40(32) Spur": { front: 2.590, rear: 2.590 },
            "Axial SCX10.3 Straight low 40(32) Spur": { front: 3.780, rear: 3.780 },
            "Axial Yeti / RR10": { front: 1.939, rear: 1.939 },
            "CCW Hidden Ninja": { front: 2.860, rear: 3.600 },
            "Dlux Cheez Berger 17% OD - 48(48) Spur": { front: 3.373, rear: 4.000 },
            "Dlux Cheez Berger No OD - 48(48) Spur": { front: 4.000, rear: 4.000 },
            "Dlux Fargo 36(48) Spur": { front: 9.000, rear: 9.000 },
            "Dlux Ham Berger - 48(48) Spur": { front: 5.000, rear: 5.000 },
            "Dlux NOD-2 - 44(48) Spur": { front: 4.000, rear: 4.000 },
            "Dlux OD-3 - 44(48) Spur": { front: 3.660, rear: 4.411 },
            "Dlux OD-3 NO OD - 44(48) Spur": { front: 3.667, rear: 3.667 },
            "Dlux OD-4 - 36(48) Spur": { front: 3.000, rear: 4.000 },
            "Dlux Portal - 36(48) Spur": { front: 3.000, rear: 3.000 },
            "Dlux Slider - 48(48) Spur": { front: 5.000, rear: 5.000 },
            "Element Stealth KNK": { front: 2.600, rear: 3.267 },
            "Element Stealth No OD": { front: 2.600, rear: 2.600 },
            "Element Stealth Opt 1": { front: 2.600, rear: 2.748 },
            "Element Stealth Opt 2": { front: 2.600, rear: 2.908 },
            "Exo Alpinist 0% - 36(48) Spur": { front: 4.910, rear: 4.910 },
            "Exo Alpinist 28% - 36(48) Spur": { front: 4.910, rear: 6.540 },
            "Exo Boulderer - 36(48) Spur": { front: 4.000, rear: 4.000 },
            "Exo Trad Climber Alpinist - 36(48) Spur": { front: 4.910, rear: 4.910 },
            "Exo Twin Rope Dual Motor": { front: 4.000, rear: 4.000 },
            "High Altitude PS200": { front: 1.540, rear: 2.000 },
            "Hotline Performance ODD - 36(48) Spur": { front: 3.000, rear: 4.000 },
            "HPI Venture Trans & Case - 60(48) Spur": { front: 2.297, rear: 2.297 },
            "MEUS Racing LCG-Gold Rush": { front: 2.000, rear: 2.533 },
            "Procrawler Grind 328 LCG OD": { front: 1.950, rear: 1.350 },
            "Procrawler Grind 431 LCG OD": { front: 1.833, rear: 2.500 },
            "Salinas Mullet": { front: 2.294, rear: 1.706 },
            "Reefs XPT3 LCG - 36(48) Spur": { front: 3.750, rear: 3.750 },
            "Salinas ODT V1 (High)": { front: 1.529, rear: 2.647 },
            "Salinas ODT V1 (Low)": { front: 1.706, rear: 2.294 },
            "Salinas ODT V1 (Med)": { front: 1.706, rear: 2.647 },
            "Supershafty SS-F6 0%": { front: 1.929, rear: 1.929 },
            "Supershafty SS-F6 18%": { front: 1.929, rear: 2.330 },
            "Supershafty SS-F6 26%": { front: 1.929, rear: 2.505 },
            "TGH 2.LOW": { front: 1.940, rear: 2.650 },
            "TGH Creeper-T": { front: 1.900, rear: 2.600 },
            "TGH O.G.": { front: 1.920, rear: 1.920 },
            "TGH O.G. OD": { front: 1.660, rear: 1.900 },
            "TGH T-210 - 26(32) Spur": { front: 5.138, rear: 7.007 },
            "ToyZuki 2.5 Transfercase": { front: 1.800, rear: 2.600 },
            "ToyZuki V1 Transfercase": { front: 2.600, rear: 2.600 },
            "Traxxas TRX-4 High Gear": { front: 0.800, rear: 0.800 },
            "Traxxas TRX-4 Low Gear": { front: 2.000, rear: 2.000 },
            "Traxxas TRX-4 Sport": { front: 2.000, rear: 2.000 },
            "VP VFD OD (21%)": { front: 2.560, rear: 3.150 },
            "VP VFD Twin High (46%)": { front: 1.966, rear: 3.150 },
            "VP VFD/VFD Twin Low (6.5%)": { front: 2.950, rear: 3.150 }
        };

        // Axle data with gear ratios
        const AXLES = {
            "AR44 / AR45 / SCX Pro OD2": 3.000,
            "AR44 / AR45 / SCX Pro OD1": 3.375,
            "AR44 / AR45 / SCX Pro / Element": 3.750,
            "AR44 / AR45 / SCX Pro UD": 4.125,
            "AR45P / Capra / SCX Pro Portal OD2 (12/23)": 5.750,
            "AR45P / Capra / SCX Pro Portal OD1 (12/23)": 6.469,
            "AR45P / Capra / SCX Pro Portal (12/23)": 7.188,
            "AR45P / Capra / SCX Pro Portal UD (12/23)": 7.906,
            "AR45P / Capra / SCX Pro Portal OD2 (13/22)": 5.077,
            "AR45P / Capra / SCX Pro Portal OD1 (13/22)": 5.712,
            "AR45P / Capra / SCX Pro Portal (13/22)": 6.346,
            "AR45P / Capra / SCX Pro Portal UD (13/22)": 6.981,
            "AR45P / Capra / SCX Pro Portal OD2 (14/21)": 4.500,
            "AR45P / Capra / SCX Pro Portal OD1 (14/21)": 5.063,
            "AR45P / Capra / SCX Pro Portal (14/21)": 5.625,
            "AR45P / Capra / SCX Pro Portal UD (14/21)": 6.188,
            "AR45P / Capra / SCX Pro Portal OD2 (15/20)": 4.000,
            "AR45P / Capra / SCX Pro Portal OD1 (15/20)": 4.500,
            "AR45P / Capra / SCX Pro Portal (15/20)": 5.000,
            "AR45P / Capra / SCX Pro Portal UD (15/20)": 5.500,
            "AR45P / Capra / SCX Pro Portal OD2 (16/19)": 3.563,
            "AR45P / Capra / SCX Pro Portal OD1 (16/19)": 4.008,
            "AR45P / Capra / SCX Pro Portal (16/19)": 4.453,
            "AR45P / Capra / SCX Pro Portal UD (16/19)": 4.898,
            "AR60 OD": 2.571,
            "AR60 STD": 2.923,
            "AR60 UD": 3.308,
            "AR60P OD (12/23)": 4.929,
            "AR60P STD (12/23)": 5.603,
            "AR60P UD (12/23)": 6.340,
            "AR60P OD (13/22": 4.352,
            "AR60P STD (13/22)": 4.947,
            "AR60P UD (13/22)": 5.598,
            "AR60P OD (14/21)": 3.857,
            "AR60P STD (14/21)": 4.385,
            "AR60P UD (14/21)": 4.962,
            "AR60P OD (15/20)": 3.429,
            "AR60P STD (15/20)": 3.897,
            "AR60P UD (15/20)": 4.410,
            "AR60P OD (16/19)": 3.054,
            "AR60P STD (16/19)": 3.471,
            "AR60P UD (16/19)": 3.928,
            "Axial AF16P STD (12/29)": 7.994,
            "Axial AF16P STD (13/28)": 7.124,
            "Axial AF16P STD (14/27)": 6.379,
            "Axial AF16P OD (12/29)": 7.064,
            "Axial AF16P OD (13/28)": 6.296,
            "Axial AF16P OD (14/27)": 5.637,
            "Dlux Superlite LOW": 14.286,
            "Dlux Superlite STD": 11.429,
            "Dlux SLP LOW (12/23)": 27.382,
            "Dlux SLP STD (12/23)": 21.906,
            "Dlux SLP LOW (15/20)": 19.048,
            "Dlux SLP STD (15/20)": 15.239,
            "Element IFS with SSD Portal (14/16)": 4.286,
            "Element IFS with SSD Portal (16/14)": 3.281,
            "Element Portal (15/20)": 5.500,
            "Element Portal (12/23)": 7.906,
            "HPI Venture": 3.308,
            "MEUS Racing Nylon Portal OD2 (20/28)": 4.200,
            "MEUS Racing Nylon Portal OD1 (20/28)": 4.725,
            "MEUS Racing Nylon Portal (20/28)": 5.250,
            "MEUS Racing Nylon Portal UD (20/28)": 5.775,
            "TRX-4 OD": 7.028,
            "TRX-4 STD": 7.899,
            "TRX-4 UD": 8.944,
            "UTB18 STD (13/28) Dlux": 5.467,
            "UTB18 STD (14/27) TGH": 4.896,
            "UTB18 STD (15/26) STK": 4.400,
            "UTB18 STD (16/25) Treal": 3.966,
            "UTB18 STD (17/24) Treal": 3.584,
            "UTB18 OD (13/28) Dlux": 4.639,
            "UTB18 OD (14/27) TGH": 4.154,
            "UTB18 OD (15/26) STK": 3.733,
            "UTB18 OD (16/25) Treal": 3.365,
            "UTB18 OD (17/24) Treal": 3.041,
            "VP Portal OD2 (18/30)": 5.000,
            "VP Portal OD1 (18/30)": 5.625,
            "VP Portal (18/30)": 6.250,
            "VP Portal UD (18/30)": 6.875,
            "VP Portal OD2 (20/28)": 4.200,
            "VP Portal OD1 (20/28)": 4.725,
            "VP Portal (20/28)": 5.250,
            "VP Portal UD (20/28)": 5.775
        };

        function getTransmissionNames() {
            return Object.keys(TRANSMISSIONS).sort();
        }

        function getAxleNames() {
            return Object.keys(AXLES).sort();
        }

        function getTransmission(name) {
            return TRANSMISSIONS[name] || null;
        }

        function getAxle(name) {
            return AXLES[name] || null;
        }

        class CrawlerCalculator {
            constructor() {
                this.results = {
                    motorRatio: 0,
                    finalFrontRatio: 0,
                    finalRearRatio: 0,
                    frontSpeed: 0,
                    rearSpeed: 0,
                    overdrivePercentage: 0
                };
            }

            calculateMotorRatio(spurTeeth, pinionTeeth) {
                if (!spurTeeth || !pinionTeeth || pinionTeeth === 0) {
                    return 0;
                }
                return spurTeeth / pinionTeeth;
            }

            calculateOverdrivePercentage(frontRatio, rearRatio) {
                if (!frontRatio || !rearRatio || frontRatio === 0 || rearRatio === 0) {
                    return 0;
                }
                
                const average = (rearRatio + frontRatio) / 2;
                return ((rearRatio - frontRatio) / average) * 100;
            }

            calculateRatios(params) {
                const {
                    spurTeeth,
                    pinionTeeth,
                    transmissionName,
                    frontAxleName,
                    rearAxleName,
                    reverseTransmission = false
                } = params;

                const motorRatio = this.calculateMotorRatio(spurTeeth, pinionTeeth);
                this.results.motorRatio = motorRatio;

                const transmission = getTransmission(transmissionName);
                const frontAxleRatio = getAxle(frontAxleName);
                const rearAxleRatio = getAxle(rearAxleName);

                if (!transmission || frontAxleRatio === null || rearAxleRatio === null) {
                    this.results.finalFrontRatio = 0;
                    this.results.finalRearRatio = 0;
                    this.results.overdrivePercentage = 0;
                    return this.results;
                }

                const frontTransRatio = reverseTransmission ? transmission.rear : transmission.front;
                const rearTransRatio = reverseTransmission ? transmission.front : transmission.rear;

                this.results.finalFrontRatio = motorRatio * frontTransRatio * frontAxleRatio;
                this.results.finalRearRatio = motorRatio * rearTransRatio * rearAxleRatio;

                this.results.overdrivePercentage = this.calculateOverdrivePercentage(
                    this.results.finalFrontRatio, 
                    this.results.finalRearRatio
                );

                return this.results;
            }

            calculateSpeeds(params) {
                const {
                    motorKV,
                    maxVoltage,
                    tireSize,
                    tireSizeUnit = 'inches'
                } = params;

                if (!motorKV || !maxVoltage || !tireSize || 
                    !this.results.finalFrontRatio || !this.results.finalRearRatio) {
                    this.results.frontSpeed = 0;
                    this.results.rearSpeed = 0;
                    return this.results;
                }

                const tireSizeInches = tireSizeUnit === 'mm' ? tireSize / 25.4 : tireSize;
                const tireCircumference = Math.PI * tireSizeInches;

                const motorRPM = motorKV * maxVoltage;

                const frontWheelRPM = motorRPM / this.results.finalFrontRatio;
                const rearWheelRPM = motorRPM / this.results.finalRearRatio;

                const frontSpeedMPH = (frontWheelRPM * tireCircumference * 60) / (12 * 5280);
                const rearSpeedMPH = (rearWheelRPM * tireCircumference * 60) / (12 * 5280);

                this.results.frontSpeed = frontSpeedMPH;
                this.results.rearSpeed = rearSpeedMPH;

                return this.results;
            }

            calculateAll(params) {
                this.calculateRatios(params);
                this.calculateSpeeds(params);
                return this.results;
            }

            getFormattedResults() {
                return {
                    motorRatio: this.formatRatio(this.results.motorRatio),
                    finalFrontRatio: this.formatRatio(this.results.finalFrontRatio),
                    finalRearRatio: this.formatRatio(this.results.finalRearRatio),
                    frontSpeed: this.formatSpeed(this.results.frontSpeed),
                    rearSpeed: this.formatSpeed(this.results.rearSpeed),
                    overdrivePercentage: this.formatPercentage(this.results.overdrivePercentage)
                };
            }

            formatRatio(ratio) {
                if (!ratio || ratio === 0) return '-';
                return `${ratio.toFixed(3)}:1`;
            }

            formatSpeed(speed) {
                if (!speed || speed === 0) return '-';
                return `${speed.toFixed(2)} MPH`;
            }

            formatPercentage(percentage) {
                if (!isFinite(percentage)) return '-';
                const sign = percentage > 0 ? '+' : '';
                return `${sign}${percentage.toFixed(1)}%`;
            }
        }

        const calculator = new CrawlerCalculator();

        // Export functionality
        function exportConfiguration() {
            try {
                console.log('Starting export...');
                
                const config = {};
                
                const getElementValue = (id, defaultValue = '') => {
                    try {
                        const element = document.getElementById(id);
                        return element ? element.value : defaultValue;
                    } catch (error) {
                        console.warn(`Could not get value for ${id}:`, error);
                        return defaultValue;
                    }
                };
                
                const getElementChecked = (id, defaultValue = false) => {
                    try {
                        const element = document.getElementById(id);
                        return element ? element.checked : defaultValue;
                    } catch (error) {
                        console.warn(`Could not get checked state for ${id}:`, error);
                        return defaultValue;
                    }
                };
                
                config.pinion = getElementValue('pinion');
                config.spur = getElementValue('spur');
                config.transmission = getElementValue('transmission');
                config.frontAxle = getElementValue('frontAxle');
                config.rearAxle = getElementValue('rearAxle');
                config.reverseTransmission = getElementChecked('reverseTransmission');
                config.motorKV = getElementValue('motorKV');
                config.voltagePreset = getElementValue('voltagePreset');
                config.maxVoltage = getElementValue('maxVoltage');
                config.tireSize = getElementValue('tireSize');
                config.tireSizeUnit = getElementValue('tireSizeUnit');
                
                console.log('Configuration collected:', config);
                
                const results = calculator.calculateAll({
                    spurTeeth: parseFloat(config.spur) || 0,
                    pinionTeeth: parseFloat(config.pinion) || 0,
                    transmissionName: config.transmission,
                    frontAxleName: config.frontAxle,
                    rearAxleName: config.rearAxle,
                    reverseTransmission: config.reverseTransmission,
                    motorKV: parseFloat(config.motorKV) || 0,
                    maxVoltage: parseFloat(config.maxVoltage) || 0,
                    tireSize: parseFloat(config.tireSize) || 0,
                    tireSizeUnit: config.tireSizeUnit
                });
                
                const content = createExportContent(config, results);
                
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `crawler-config-${new Date().toISOString().slice(0, 10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                console.log('Configuration exported successfully');
                
                const exportBtn = document.getElementById('exportBtn');
                if (exportBtn) {
                    const originalText = exportBtn.textContent;
                    exportBtn.textContent = 'Exported!';
                    exportBtn.style.backgroundColor = '#28a745';
                    setTimeout(() => {
                        exportBtn.textContent = originalText;
                        exportBtn.style.backgroundColor = '#000000';
                    }, 2000);
                }
                
            } catch (error) {
                console.error('Export error:', error);
                alert('Error exporting configuration. Please check the console for details and try again.');
            }
        }

        function createExportContent(config, results) {
            const timestamp = new Date().toLocaleString();
            const formatted = calculator.getFormattedResults();
            
            let voltagePresetText = 'Custom';
            try {
                const voltagePresetEl = document.getElementById('voltagePreset');
                if (voltagePresetEl && voltagePresetEl.selectedIndex >= 0) {
                    const selectedOption = voltagePresetEl.options[voltagePresetEl.selectedIndex];
                    if (selectedOption && selectedOption.text && config.voltagePreset) {
                        voltagePresetText = selectedOption.text;
                    }
                }
            } catch (error) {
                console.warn('Could not get voltage preset text:', error);
                voltagePresetText = 'Custom';
            }
            
            return `===============================================
         RC CRAWLER GEAR RATIO CALCULATOR
                 ydrRC Configuration
===============================================
Export Date: ${timestamp}

DRIVETRAIN CONFIGURATION:
========================
Pinion Gear:           ${config.pinion} teeth
Spur Gear:             ${config.spur} teeth
Transmission:          ${config.transmission}
Front Axle:            ${config.frontAxle}
Rear Axle:             ${config.rearAxle}
Reverse Transmission:  ${config.reverseTransmission ? 'YES' : 'NO'}

POWER SYSTEM:
=============
Motor KV:              ${config.motorKV}
Voltage Preset:        ${voltagePresetText}
Max Voltage:           ${config.maxVoltage}V
Tire Size:             ${config.tireSize} ${config.tireSizeUnit}

CALCULATED RESULTS:
==================
Motor Gear Ratio:      ${formatted.motorRatio}
Final Front Ratio:     ${formatted.finalFrontRatio}
Final Rear Ratio:      ${formatted.finalRearRatio}
Approx. Front Speed:   ${formatted.frontSpeed}
Approx. Rear Speed:    ${formatted.rearSpeed}

CONFIGURATION DATA (DO NOT EDIT):
=================================
CONFIG_START
pinion=${config.pinion}
spur=${config.spur}
transmission=${config.transmission}
frontAxle=${config.frontAxle}
rearAxle=${config.rearAxle}
reverseTransmission=${config.reverseTransmission}
motorKV=${config.motorKV}
voltagePreset=${config.voltagePreset}
maxVoltage=${config.maxVoltage}
tireSize=${config.tireSize}
tireSizeUnit=${config.tireSizeUnit}
CONFIG_END

===============================================
Generated by ydrRC Crawler Calculator
===============================================`;
        }

        function calculate() {
            try {
                const params = {
                    spurTeeth: parseFloat(document.getElementById('spur').value) || 0,
                    pinionTeeth: parseFloat(document.getElementById('pinion').value) || 0,
                    transmissionName: document.getElementById('transmission').value,
                    frontAxleName: document.getElementById('frontAxle').value,
                    rearAxleName: document.getElementById('rearAxle').value,
                    reverseTransmission: document.getElementById('reverseTransmission').checked,
                    motorKV: parseFloat(document.getElementById('motorKV').value) || 0,
                    maxVoltage: parseFloat(document.getElementById('maxVoltage').value) || 0,
                    tireSize: parseFloat(document.getElementById('tireSize').value) || 0,
                    tireSizeUnit: document.getElementById('tireSizeUnit').value
                };
                
                const results = calculator.calculateAll(params);
                const formatted = calculator.getFormattedResults();
                
                const transmission = getTransmission(params.transmissionName);
                const frontAxleRatio = getAxle(params.frontAxleName);
                const rearAxleRatio = getAxle(params.rearAxleName);
                
                const motorRatioEl = document.getElementById('motorRatio');
                const transmissionRatioEl = document.getElementById('transmissionRatio');
                const frontAxleRatioEl = document.getElementById('frontAxleRatio');
                const rearAxleRatioEl = document.getElementById('rearAxleRatio');
                const frontRatioEl = document.getElementById('frontRatio');
                const rearRatioEl = document.getElementById('rearRatio');
                const overdrivePercentageEl = document.getElementById('overdrivePercentage');
                const frontSpeedEl = document.getElementById('frontSpeed');
                const rearSpeedEl = document.getElementById('rearSpeed');
                
                if (motorRatioEl) motorRatioEl.textContent = formatted.motorRatio;
                
                if (transmissionRatioEl && transmission) {
                    const frontTransRatio = params.reverseTransmission ? transmission.rear : transmission.front;
                    const rearTransRatio = params.reverseTransmission ? transmission.front : transmission.rear;
                    
                    if (frontTransRatio === rearTransRatio) {
                        transmissionRatioEl.textContent = `${frontTransRatio.toFixed(3)}:1`;
                    } else {
                        transmissionRatioEl.textContent = `F:${frontTransRatio.toFixed(3)} R:${rearTransRatio.toFixed(3)}`;
                    }
                } else if (transmissionRatioEl) {
                    transmissionRatioEl.textContent = '-';
                }
                
                if (frontAxleRatioEl) {
                    frontAxleRatioEl.textContent = frontAxleRatio ? `${frontAxleRatio.toFixed(3)}:1` : '-';
                }
                if (rearAxleRatioEl) {
                    rearAxleRatioEl.textContent = rearAxleRatio ? `${rearAxleRatio.toFixed(3)}:1` : '-';
                }
                
                if (frontRatioEl) frontRatioEl.textContent = formatted.finalFrontRatio;
                if (rearRatioEl) rearRatioEl.textContent = formatted.finalRearRatio;
                if (overdrivePercentageEl) overdrivePercentageEl.textContent = formatted.overdrivePercentage;
                if (frontSpeedEl) frontSpeedEl.textContent = formatted.frontSpeed;
                if (rearSpeedEl) rearSpeedEl.textContent = formatted.rearSpeed;
                
            } catch (error) {
                console.error('Calculation error:', error);
            }
        }

        let debounceTimer = null;
        function debounceCalculate() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(calculate, 300);
        }

        function populateTransmissions() {
            const select = document.getElementById('transmission');
            if (!select) return;
            
            const transmissions = getTransmissionNames();
            
            transmissions.forEach(transmission => {
                const option = document.createElement('option');
                option.value = transmission;
                option.textContent = transmission;
                select.appendChild(option);
            });
        }

        function populateAxles() {
            const frontSelect = document.getElementById('frontAxle');
            const rearSelect = document.getElementById('rearAxle');
            
            if (!frontSelect || !rearSelect) return;
            
            const axles = getAxleNames();
            
            axles.forEach(axle => {
                const frontOption = document.createElement('option');
                frontOption.value = axle;
                frontOption.textContent = axle;
                frontSelect.appendChild(frontOption);
                
                const rearOption = document.createElement('option');
                rearOption.value = axle;
                rearOption.textContent = axle;
                rearSelect.appendChild(rearOption);
            });
        }

        function setDefaults() {
            const transmissionEl = document.getElementById('transmission');
            if (transmissionEl) {
                transmissionEl.value = 'Axial 3-Gear';
            }
            
            const frontAxleEl = document.getElementById('frontAxle');
            if (frontAxleEl) {
                frontAxleEl.value = 'AR44 / AR45 / SCX Pro / Element';
            }
            
            const rearAxleEl = document.getElementById('rearAxle');
            if (rearAxleEl) {
                rearAxleEl.value = 'AR44 / AR45 / SCX Pro / Element';
            }
        }

        // Import functionality
        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) {
                console.log('No file selected');
                return;
            }
            
            console.log('Importing file:', file.name);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    console.log('File content preview:', content.substring(0, 200));
                    
                    const config = parseImportContent(content);
                    
                    if (config && Object.keys(config).length > 0) {
                        console.log('Valid config found, applying...');
                        applyImportedConfig(config);
                        showImportFeedback('Configuration imported successfully!', 'success');
                        
                        // Force recalculation
                        setTimeout(calculate, 100);
                    } else {
                        console.error('No valid config found');
                        showImportFeedback('Could not find valid configuration data in file', 'error');
                    }
                } catch (error) {
                    console.error('Import error:', error);
                    showImportFeedback('Error: ' + error.message, 'error');
                }
                
                // Reset file input
                event.target.value = '';
            };
            
            reader.onerror = function() {
                showImportFeedback('Failed to read file', 'error');
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }

        function parseImportContent(content) {
            console.log('Starting to parse content...');
            
            // Find the config section
            const configStart = content.indexOf('CONFIG_START');
            const configEnd = content.indexOf('CONFIG_END');
            
            if (configStart === -1 || configEnd === -1) {
                console.log('Config markers not found, trying alternative parsing...');
                
                // Try alternative parsing - look for key=value patterns
                const lines = content.split('\n');
                const config = {};
                let foundAny = false;
                
                for (const line of lines) {
                    const trimmed = line.trim();
                    if (trimmed.includes('=') && !trimmed.startsWith('#') && !trimmed.startsWith('=')) {
                        const parts = trimmed.split('=');
                        if (parts.length >= 2) {
                            const key = parts[0].trim();
                            const value = parts.slice(1).join('=').trim();
                            
                            // Only accept known config keys
                            if (['pinion', 'spur', 'transmission', 'frontAxle', 'rearAxle', 'reverseTransmission', 'motorKV', 'voltagePreset', 'maxVoltage', 'tireSize', 'tireSizeUnit'].includes(key)) {
                                if (value === 'true') {
                                    config[key] = true;
                                } else if (value === 'false') {
                                    config[key] = false;
                                } else {
                                    config[key] = value;
                                }
                                foundAny = true;
                                console.log(`Found: ${key} = ${value}`);
                            }
                        }
                    }
                }
                
                return foundAny ? config : null;
            }
            
            // Extract config section between markers
            const configSection = content.substring(configStart + 12, configEnd).trim();
            console.log('Config section found:', configSection);
            
            const config = {};
            const lines = configSection.split('\n');
            
            for (const line of lines) {
                const trimmed = line.trim();
                if (trimmed && trimmed.includes('=')) {
                    const equalPos = trimmed.indexOf('=');
                    const key = trimmed.substring(0, equalPos).trim();
                    const value = trimmed.substring(equalPos + 1).trim();
                    
                    if (key) {
                        if (value === 'true') {
                            config[key] = true;
                        } else if (value === 'false') {
                            config[key] = false;
                        } else {
                            config[key] = value;
                        }
                        console.log(`Parsed: ${key} = ${config[key]}`);
                    }
                }
            }
            
            return config;
        }

        function applyImportedConfig(config) {
            console.log('Applying config:', config);
            
            // Helper function to safely set values
            const setValue = (id, value) => {
                const element = document.getElementById(id);
                if (element && value !== undefined && value !== null && value !== '') {
                    console.log(`Setting ${id} to: ${value}`);
                    element.value = value;
                    return true;
                }
                console.log(`Skipping ${id} - element:`, !!element, 'value:', value);
                return false;
            };
            
            const setChecked = (id, checked) => {
                const element = document.getElementById(id);
                if (element && checked !== undefined && checked !== null) {
                    console.log(`Setting ${id} checked to: ${checked}`);
                    element.checked = checked;
                    return true;
                }
                return false;
            };
            
            // Apply all values
            setValue('pinion', config.pinion);
            setValue('spur', config.spur);
            setValue('transmission', config.transmission);
            setValue('frontAxle', config.frontAxle);
            setValue('rearAxle', config.rearAxle);
            setChecked('reverseTransmission', config.reverseTransmission);
            setValue('motorKV', config.motorKV);
            setValue('voltagePreset', config.voltagePreset);
            setValue('maxVoltage', config.maxVoltage);
            setValue('tireSize', config.tireSize);
            setValue('tireSizeUnit', config.tireSizeUnit);
            
            // Handle voltage logic
            const voltagePreset = document.getElementById('voltagePreset');
            const maxVoltage = document.getElementById('maxVoltage');
            
            if (voltagePreset && maxVoltage) {
                if (config.voltagePreset && config.voltagePreset !== '') {
                    maxVoltage.disabled = true;
                    maxVoltage.style.backgroundColor = '#e9ecef';
                    maxVoltage.style.cursor = 'not-allowed';
                } else {
                    maxVoltage.disabled = false;
                    maxVoltage.style.backgroundColor = 'white';
                    maxVoltage.style.cursor = 'text';
                }
            }
            
            console.log('Config application complete');
        }

        function showImportFeedback(message, type) {
            // Create feedback element
            const feedback = document.createElement('div');
            feedback.textContent = message;
            feedback.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : '#f44336'};
                color: white;
                padding: 15px 20px;
                border-radius: 4px;
                font-size: 14px;
                font-weight: bold;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideInRight 0.3s ease-out;
            `;
            
            // Add animation keyframes
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(feedback);
            
            // Remove after 3 seconds
            setTimeout(() => {
                if (feedback.parentNode) {
                    feedback.parentNode.removeChild(feedback);
                }
                if (style.parentNode) {
                    style.parentNode.removeChild(style);
                }
            }, 3000);
        }

        function addEventListeners() {
            const inputs = ['pinion', 'spur', 'transmission', 'frontAxle', 'rearAxle', 'reverseTransmission', 'motorKV', 'maxVoltage', 'tireSize', 'tireSizeUnit'];
            
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', calculate);
                    element.addEventListener('input', debounceCalculate);
                }
            });
            
            // Add export button listener
            const exportBtn = document.getElementById('exportBtn');
            if (exportBtn) {
                exportBtn.addEventListener('click', exportConfiguration);
            }
            
            // Add import file listener
            const importFile = document.getElementById('importFile');
            if (importFile) {
                importFile.addEventListener('change', handleImportFile);
            }
            
            // Add voltage preset listener
            const voltagePresetEl = document.getElementById('voltagePreset');
            const maxVoltageEl = document.getElementById('maxVoltage');
            
            if (voltagePresetEl && maxVoltageEl) {
                voltagePresetEl.addEventListener('change', function() {
                    if (this.value) {
                        maxVoltageEl.value = this.value;
                        maxVoltageEl.disabled = true;
                        maxVoltageEl.style.backgroundColor = '#e9ecef';
                        maxVoltageEl.style.cursor = 'not-allowed';
                    } else {
                        maxVoltageEl.disabled = false;
                        maxVoltageEl.style.backgroundColor = 'white';
                        maxVoltageEl.style.cursor = 'text';
                    }
                    calculate();
                });
            }
        }

        // Clipboard functionality
        function copyToClipboard(element) {
            const valueElement = element.querySelector('.value');
            const titleElement = element.querySelector('h3');
            
            if (!valueElement || !titleElement) return;
            
            let value = valueElement.textContent.trim();
            const title = titleElement.textContent.trim();
            
            if (!value || value === '-') {
                showCopyFeedback(element, 'No value to copy', 'error');
                return;
            }
            
            if (value.includes(':1')) {
                value = value.split(':1')[0];
            } else {
                const numberMatch = value.match(/[\d,.]+/);
                if (numberMatch) {
                    value = numberMatch[0];
                }
            }
            
            const textToCopy = value;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showCopyFeedback(element, 'Copied!', 'success');
                }).catch(() => {
                    fallbackCopyToClipboard(textToCopy, element);
                });
            } else {
                fallbackCopyToClipboard(textToCopy, element);
            }
        }
        
        function fallbackCopyToClipboard(text, element) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopyFeedback(element, 'Copied!', 'success');
                } else {
                    showCopyFeedback(element, 'Copy failed', 'error');
                }
            } catch (err) {
                showCopyFeedback(element, 'Copy not supported', 'error');
            }
            
            document.body.removeChild(textArea);
        }
        
        function showCopyFeedback(element, message, type) {
            element.classList.add('copied');
            
            const feedback = document.createElement('div');
            feedback.textContent = message;
            feedback.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: ${type === 'success' ? '#4CAF50' : '#f44336'};
                color: white;
                padding: 8px 16px;
                border-radius: 4px;
                font-size: 14px;
                font-weight: bold;
                z-index: 1000;
                pointer-events: none;
                animation: fadeInOut 1.5s ease-out forwards;
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                    20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                }
            `;
            document.head.appendChild(style);
            
            element.style.position = 'relative';
            element.appendChild(feedback);
            
            setTimeout(() => {
                element.classList.remove('copied');
                if (feedback.parentNode) {
                    feedback.parentNode.removeChild(feedback);
                }
                document.head.removeChild(style);
            }, 1500);
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, starting initialization...');
            
            try {
                populateTransmissions();
                populateAxles();
                
                // Set defaults after population
                setTimeout(() => {
                    setDefaults();
                    calculate();
                }, 100);
                
                addEventListeners();
                
                console.log('Initialization complete');
            } catch (error) {
                console.error('Initialization error:', error);
            }
        });
    </script>
</body>
</html>