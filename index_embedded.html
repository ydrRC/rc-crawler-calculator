<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RC Crawler Gear Ratio Calculator</title>
    <meta name="description" content="Professional RC crawler gear ratio calculator with speed calculations">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-brand">
                <a href="https://www.ydrRC.com" target="_blank">
                    <img src="images/ydrRC_Logo.png" 
                         alt="ydrRC Logo" 
                         class="brand-logo"
                         onerror="this.style.display='none'">
                </a>
                <div class="header-text">
                    <h1>Crawler Gear Ratio Calculator</h1>
                    <p>Calculate gear ratios and theoretical speeds for your RC crawler</p>
                </div>
            </div>
        </header>
        
        <main class="content">
            <section class="input-section">
                <h2>Input Parameters</h2>
                
                <div class="import-export-buttons">
                    <button type="button" id="exportBtn" class="action-btn">Export Configuration</button>
                    <label for="importFile" class="action-btn">Import Configuration</label>
                    <input type="file" id="importFile" accept=".txt,.asc" style="display: none;">
                </div>
                
                <div class="input-group">
                    <label for="pinion">Pinion Gear Tooth Count:</label>
                    <input type="number" id="pinion" value="13" min="8" max="30" required>
                </div>
                
                <div class="input-group">
                    <label for="spur">Spur Gear Tooth Count:</label>
                    <input type="number" id="spur" value="56" min="20" max="100" required>
                </div>
                
                <div class="input-group">
                    <label for="transmission">Transmission:</label>
                    <select id="transmission" required>
                        <option value="">Select Transmission...</option>
                    </select>
                    <div class="checkbox-group">
                        <input type="checkbox" id="reverseTransmission">
                        <label for="reverseTransmission">Reverse Transmission Ratio</label>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="frontAxle">Front Axle:</label>
                    <select id="frontAxle" required>
                        <option value="">Select Front Axle...</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="rearAxle">Rear Axle:</label>
                    <select id="rearAxle" required>
                        <option value="">Select Rear Axle...</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="motorKV">Motor KV Value:</label>
                    <input type="number" id="motorKV" value="1800" min="100" max="5000">
                </div>
                
                <div class="input-group">
                    <label>Max Battery Voltage:</label>
                    <div class="voltage-group">
                        <select id="voltagePreset">
                            <option value="">Select Preset or Enter Custom...</option>
                            <option value="8.4">8.4V (2S)</option>
                            <option value="12.6" selected>12.6V (3S)</option>
                            <option value="16.8">16.8V (4S)</option>
                            <option value="21.0">21.0V (5S)</option>
                            <option value="25.2">25.2V (6S)</option>
                        </select>
                        <input type="number" id="maxVoltage" value="12.6" step="0.1" min="3" max="30" placeholder="Custom voltage" disabled style="background-color: #e9ecef; cursor: not-allowed;">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Tire Size:</label>
                    <div class="tire-size-group">
                        <input type="number" id="tireSize" value="4.75" step="0.01" min="2" max="6">
                        <select id="tireSizeUnit">
                            <option value="inches">inches</option>
                            <option value="mm">mm</option>
                        </select>
                    </div>
                </div>
            </section>
            
            <section class="results-section">
                <h2>Calculation Results</h2>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Motor Gear Ratio</h3>
                    <div class="value" id="motorRatio">4.308:1</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Transmission Ratio</h3>
                    <div class="value" id="transmissionRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Front Axle Ratio</h3>
                    <div class="value" id="frontAxleRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Rear Axle Ratio</h3>
                    <div class="value" id="rearAxleRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Final Front Ratio</h3>
                    <div class="value" id="frontRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Final Rear Ratio</h3>
                    <div class="value" id="rearRatio">-</div>
                </div>
                
                <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                    <h3>Overdrive Percentage</h3>
                    <div class="value" id="overdrivePercentage">-</div>
                </div>
                
                <div class="speed-results">
                    <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                        <h3>Approx. Front Speed</h3>
                        <div class="value" id="frontSpeed">-</div>
                    </div>
                    
                    <div class="result-item clickable" onclick="copyToClipboard(this)" title="Click to copy">
                        <h3>Approx. Rear Speed</h3>
                        <div class="value" id="rearSpeed">-</div>
                    </div>
                </div>
            </section>
        </main>
        
        <section class="notes-section">
            <h2>Notes</h2>
            <div class="notes-content">
                <p class="first-note">Many thanks to Travis Miller for originally creating this sheet. I've put a lot of time into updating it and I hope it works for everyone. I also want to thank Mehmet Tuzel for all his help in double checking my work and many suggestions on axles and transmissions to add to the list.</p>
                
                <p>Some transmissions do not require a spur and have one built in. In these cases, there will be a description of the built in spur after the transmission name. You'll need to select this spur from the spur list to get correct calculations.</p>
                
                <p>For AR44 based axles, the OD1 = 27/8 gearing and OD2 = 24/8 gearing available from Boom Racing and Team Ottsix Racing.</p>
                
                <p>The numbers in () after the axle names represent the portal gear sizes. They are lots of options for Capra/AR45P axles and a couple for Vanquish portals.</p>
                
                <p>You can manually override the Pinion, Spur, and Tire Size values. There are too many options to maintain a complete list.</p>
                
                <p>Please let me know of any other axles and transmissions that can be added. I know there are more, but I couldn't find info on some.</p>
                
                <p>Overdrive % numbers may not match what you are expecting as many suppliers/manufacturers do not calculate this value correctly. This sheet uses the Percent Difference Formula.</p>
                
                <p>If your overdrive % is a negative number, your rear axle will be faster than the front. This is usually not the desired setup.</p>
                
                <p>If you are running a straight axle in the front and a portal axle in the rear, you may choose to mount your transmission with OD to the rear. To enable this, just check the reverse box under the transmission drop-down.</p>
                
                <p>If you have any questions, issues, or suggestions, please contact me at jeff@ydrRC.com</p>
            </div>
        </section>
        
        <footer class="footer">
            <a href="https://www.ydrRC.com" target="_blank">
                <img src="images/YDR.png" 
                     alt="You're Damn Right Logo" 
                     class="footer-logo"
                     onerror="this.style.display='none'">
            </a>
            <div class="footer-content">
                <p>&copy; 2025 <span class="ydrrc-text"></span> Crawler Calculator. Licensed under CC BY-NC-SA 4.0</p>
                <div class="version-info">
                    <span class="version-label">Version</span>
                    <span class="version-number" id="versionNumber">2.1.0</span>
                    <span class="version-date">Build: June 2025</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Embedded JavaScript - All in one file -->
    <script>
        // Data Tables
        const TRANSMISSIONS = {
            "Axial 3-Gear": { front: 2.600, rear: 2.600 },
            "Axial Capra - 34(32) Spur": { front: 1.800, rear: 1.800 },
            "Axial Capra UTB18 40 (48) Spur": { front: 3.825, rear: 3.825 },
            "Axial Capra UTB18 [TGH] 42 (48) Spur": { front: 3.825, rear: 3.825 },
            "Axial LCXU (Basecamp) - Portal": { front: 1.643, rear: 1.643 },
            "Axial LCXU (Basecamp) - Straight": { front: 2.614, rear: 2.614 },
            "Axial SCX10 Pro - 0% OD": { front: 2.222, rear: 2.222 },
            "Axial SCX10 Pro - 40% OD": { front: 2.222, rear: 3.322 },
            "Axial SCX10.3 Portal high 40(32) Spur": { front: 1.520, rear: 1.520 },
            "Axial SCX10.3 Portal low 40(32) Spur": { front: 2.220, rear: 2.220 },
            "Axial SCX10.3 Straight high 40(32) Spur": { front: 2.590, rear: 2.590 },
            "Axial SCX10.3 Straight low 40(32) Spur": { front: 3.780, rear: 3.780 },
            "Axial Yeti / RR10": { front: 1.939, rear: 1.939 },
            "CCW Hidden Ninja": { front: 2.860, rear: 3.600 },
            "Dlux Cheez Berger 17% OD - 48(48) Spur": { front: 3.373, rear: 4.000 },
            "Dlux Cheez Berger No OD - 48(48) Spur": { front: 4.000, rear: 4.000 },
            "Dlux Fargo 36(48) Spur": { front: 9.000, rear: 9.000 },
            "Dlux Ham Berger - 48(48) Spur": { front: 5.000, rear: 5.000 },
            "Dlux NOD-2 - 44(48) Spur": { front: 4.000, rear: 4.000 },
            "Dlux OD-3 - 44(48) Spur": { front: 3.660, rear: 4.411 },
            "Dlux OD-3 NO OD - 44(48) Spur": { front: 3.667, rear: 3.667 },
            "Dlux OD-4 - 36(48) Spur": { front: 3.000, rear: 4.000 },
            "Dlux Portal - 36(48) Spur": { front: 3.000, rear: 3.000 },
            "Dlux Slider - 48(48) Spur": { front: 5.000, rear: 5.000 },
            "Element Stealth KNK": { front: 2.600, rear: 3.267 },
            "Element Stealth No OD": { front: 2.600, rear: 2.600 },
            "Element Stealth Opt 1": { front: 2.600, rear: 2.748 },
            "Element Stealth Opt 2": { front: 2.600, rear: 2.908 },
            "Exo Alpinist 0% - 36(48) Spur": { front: 4.910, rear: 4.910 },
            "Exo Alpinist 28% - 36(48) Spur": { front: 4.910, rear: 6.540 },
            "Exo Boulderer - 36(48) Spur": { front: 4.000, rear: 4.000 },
            "Exo Trad Climber Alpinist - 36(48) Spur": { front: 4.910, rear: 4.910 },
            "Exo Twin Rope Dual Motor": { front: 4.000, rear: 4.000 },
            "High Altitude PS200": { front: 1.540, rear: 2.000 },
            "Hotline Performance ODD - 36(48) Spur": { front: 3.000, rear: 4.000 },
            "HPI Venture Trans & Case - 60(48) Spur": { front: 2.297, rear: 2.297 },
            "MEUS Racing LCG-Gold Rush": { front: 2.000, rear: 2.533 },
            "Procrawler Grind 328 LCG OD": { front: 1.950, rear: 1.350 },
            "Procrawler Grind 431 LCG OD": { front: 1.833, rear: 2.500 },
            "Salinas Mullet": { front: 2.294, rear: 1.706 },
            "Reefs XPT3 LCG - 36(48) Spur": { front: 3.750, rear: 3.750 },
            "Salinas ODT V1 (High)": { front: 1.529, rear: 2.647 },
            "Salinas ODT V1 (Low)": { front: 1.706, rear: 2.294 },
            "Salinas ODT V1 (Med)": { front: 1.706, rear: 2.647 },
            "Supershafty SS-F6 0%": { front: 1.929, rear: 1.929 },
            "Supershafty SS-F6 18%": { front: 1.929, rear: 2.330 },
            "Supershafty SS-F6 26%": { front: 1.929, rear: 2.505 },
            "TGH 2.LOW": { front: 1.940, rear: 2.650 },
            "TGH Creeper-T": { front: 1.900, rear: 2.600 },
            "TGH O.G.": { front: 1.920, rear: 1.920 },
            "TGH O.G. OD": { front: 1.660, rear: 1.900 },
            "TGH T-210 - 26(32) Spur": { front: 5.138, rear: 7.007 },
            "ToyZuki 2.5 Transfercase": { front: 1.800, rear: 2.600 },
            "ToyZuki V1 Transfercase": { front: 2.600, rear: 2.600 },
            "Traxxas TRX-4 High Gear": { front: 0.800, rear: 0.800 },
            "Traxxas TRX-4 Low Gear": { front: 2.000, rear: 2.000 },
            "Traxxas TRX-4 Sport": { front: 2.000, rear: 2.000 },
            "VP VFD OD (21%)": { front: 2.560, rear: 3.150 },
            "VP VFD Twin High (46%)": { front: 1.966, rear: 3.150 },
            "VP VFD/VFD Twin Low (6.5%)": { front: 2.950, rear: 3.150 }
        };

        const AXLES = {
            "AR44 / AR45 / SCX Pro OD2": 3.000,
            "AR44 / AR45 / SCX Pro OD1": 3.375,
            "AR44 / AR45 / SCX Pro / Element": 3.750,
            "AR44 / AR45 / SCX Pro UD": 4.125,
            "AR45P / Capra / SCX Pro Portal OD2 (12/23)": 5.750,
            "AR45P / Capra / SCX Pro Portal OD1 (12/23)": 6.469,
            "AR45P / Capra / SCX Pro Portal (12/23)": 7.188,
            "AR45P / Capra / SCX Pro Portal UD (12/23)": 7.906,
            "AR45P / Capra / SCX Pro Portal OD2 (13/22)": 5.077,
            "AR45P / Capra / SCX Pro Portal OD1 (13/22)": 5.712,
            "AR45P / Capra / SCX Pro Portal (13/22)": 6.346,
            "AR45P / Capra / SCX Pro Portal UD (13/22)": 6.981,
            "AR45P / Capra / SCX Pro Portal OD2 (14/21)": 4.500,
            "AR45P / Capra / SCX Pro Portal OD1 (14/21)": 5.063,
            "AR45P / Capra / SCX Pro Portal (14/21)": 5.625,
            "AR45P / Capra / SCX Pro Portal UD (14/21)": 6.188,
            "AR45P / Capra / SCX Pro Portal OD2 (15/20)": 4.000,
            "AR45P / Capra / SCX Pro Portal OD1 (15/20)": 4.500,
            "AR45P / Capra / SCX Pro Portal (15/20)": 5.000,
            "AR45P / Capra / SCX Pro Portal UD (15/20)": 5.500,
            "AR45P / Capra / SCX Pro Portal OD2 (16/19)": 3.563,
            "AR45P / Capra / SCX Pro Portal OD1 (16/19)": 4.008,
            "AR45P / Capra / SCX Pro Portal (16/19)": 4.453,
            "AR45P / Capra / SCX Pro Portal UD (16/19)": 4.898,
            "AR60 OD": 2.571,
            "AR60 STD": 2.923,
            "AR60 UD": 3.308,
            "AR60P OD (12/23)": 4.929,
            "AR60P STD (12/23)": 5.603,
            "AR60P UD (12/23)": 6.340,
            "AR60P OD (13/22": 4.352,
            "AR60P STD (13/22)": 4.947,
            "AR60P UD (13/22)": 5.598,
            "AR60P OD (14/21)": 3.857,
            "AR60P STD (14/21)": 4.385,
            "AR60P UD (14/21)": 4.962,
            "AR60P OD (15/20)": 3.429,
            "AR60P STD (15/20)": 3.897,
            "AR60P UD (15/20)": 4.410,
            "AR60P OD (16/19)": 3.054,
            "AR60P STD (16/19)": 3.471,
            "AR60P UD (16/19)": 3.928,
            "Axial AF16P STD (12/29)": 7.994,
            "Axial AF16P STD (13/28)": 7.124,
            "Axial AF16P STD (14/27)": 6.379,
            "Axial AF16P OD (12/29)": 7.064,
            "Axial AF16P OD (13/28)": 6.296,
            "Axial AF16P OD (14/27)": 5.637,
            "Dlux Superlite LOW": 14.286,
            "Dlux Superlite STD": 11.429,
            "Dlux SLP LOW (12/23)": 27.382,
            "Dlux SLP STD (12/23)": 21.906,
            "Dlux SLP LOW (15/20)": 19.048,
            "Dlux SLP STD (15/20)": 15.239,
            "Element IFS with SSD Portal (14/16)": 4.286,
            "Element IFS with SSD Portal (16/14)": 3.281,
            "Element Portal (15/20)": 5.500,
            "Element Portal (12/23)": 7.906,
            "HPI Venture": 3.308,
            "MEUS Racing Nylon Portal OD2 (20/28)": 4.200,
            "MEUS Racing Nylon Portal OD1 (20/28)": 4.725,
            "MEUS Racing Nylon Portal (20/28)": 5.250,
            "MEUS Racing Nylon Portal UD (20/28)": 5.775,
            "TRX-4 OD": 7.028,
            "TRX-4 STD": 7.899,
            "TRX-4 UD": 8.944,
            "UTB18 STD (13/28) Dlux": 5.467,
            "UTB18 STD (14/27) TGH": 4.896,
            "UTB18 STD (15/26) STK": 4.400,
            "UTB18 STD (16/25) Treal": 3.966,
            "UTB18 STD (17/24) Treal": 3.584,
            "UTB18 OD (13/28) Dlux": 4.639,
            "UTB18 OD (14/27) TGH": 4.154,
            "UTB18 OD (15/26) STK": 3.733,
            "UTB18 OD (16/25) Treal": 3.365,
            "UTB18 OD (17/24) Treal": 3.041,
            "VP Portal OD2 (18/30)": 5.000,
            "VP Portal OD1 (18/30)": 5.625,
            "VP Portal (18/30)": 6.250,
            "VP Portal UD (18/30)": 6.875,
            "VP Portal OD2 (20/28)": 4.200,
            "VP Portal OD1 (20/28)": 4.725,
            "VP Portal (20/28)": 5.250,
            "VP Portal UD (20/28)": 5.775
        };

        // Version management
        const APP_VERSION = {
            major: 2,
            minor: 1,
            patch: 0,
            build: 'June 2025',
            get full() {
                return `${this.major}.${this.minor}.${this.patch}`;
            },
            get display() {
                return `v${this.full} (${this.build})`;
            }
        };

        // Update version display on load
        function updateVersionDisplay() {
            const versionEl = document.getElementById('versionNumber');
            if (versionEl) {
                versionEl.textContent = APP_VERSION.full;
            }
            
            // Add version to console for debugging
            console.log(`RC Crawler Calculator ${APP_VERSION.display}`);
            
            // Add version to page title for identification
            document.title += ` - v${APP_VERSION.full}`;
        }

        // Helper functions
        function getTransmissionNames() {
            return Object.keys(TRANSMISSIONS).sort();
        }

        function getAxleNames() {
            return Object.keys(AXLES).sort();
        }

        function getTransmission(name) {
            return TRANSMISSIONS[name] || null;
        }

        function getAxle(name) {
            return AXLES[name] || null;
        }

        // Calculator class
        class CrawlerCalculator {
            constructor() {
                this.results = {
                    motorRatio: 0,
                    finalFrontRatio: 0,
                    finalRearRatio: 0,
                    frontSpeed: 0,
                    rearSpeed: 0,
                    overdrivePercentage: 0
                };
            }

            calculateMotorRatio(spurTeeth, pinionTeeth) {
                if (!spurTeeth || !pinionTeeth || pinionTeeth === 0) {
                    return 0;
                }
                return spurTeeth / pinionTeeth;
            }

            calculateOverdrivePercentage(frontRatio, rearRatio) {
                if (!frontRatio || !rearRatio || frontRatio === 0 || rearRatio === 0) {
                    return 0;
                }
                const average = (rearRatio + frontRatio) / 2;
                return ((rearRatio - frontRatio) / average) * 100;
            }

            calculateRatios(params) {
                const {
                    spurTeeth,
                    pinionTeeth,
                    transmissionName,
                    frontAxleName,
                    rearAxleName,
                    reverseTransmission = false
                } = params;

                const motorRatio = this.calculateMotorRatio(spurTeeth, pinionTeeth);
                this.results.motorRatio = motorRatio;

                const transmission = getTransmission(transmissionName);
                const frontAxleRatio = getAxle(frontAxleName);
                const rearAxleRatio = getAxle(rearAxleName);

                if (!transmission || frontAxleRatio === null || rearAxleRatio === null) {
                    this.results.finalFrontRatio = 0;
                    this.results.finalRearRatio = 0;
                    this.results.overdrivePercentage = 0;
                    return this.results;
                }

                const frontTransRatio = reverseTransmission ? transmission.rear : transmission.front;
                const rearTransRatio = reverseTransmission ? transmission.front : transmission.rear;

                this.results.finalFrontRatio = motorRatio * frontTransRatio * frontAxleRatio;
                this.results.finalRearRatio = motorRatio * rearTransRatio * rearAxleRatio;

                this.results.overdrivePercentage = this.calculateOverdrivePercentage(
                    this.results.finalFrontRatio, 
                    this.results.finalRearRatio
                );

                return this.results;
            }

            calculateSpeeds(params) {
                const {
                    motorKV,
                    maxVoltage,
                    tireSize,
                    tireSizeUnit = 'inches'
                } = params;

                if (!motorKV || !maxVoltage || !tireSize || 
                    !this.results.finalFrontRatio || !this.results.finalRearRatio) {
                    this.results.frontSpeed = 0;
                    this.results.rearSpeed = 0;
                    return this.results;
                }

                const tireSizeInches = tireSizeUnit === 'mm' ? tireSize / 25.4 : tireSize;
                const tireCircumference = Math.PI * tireSizeInches;

                const motorRPM = motorKV * maxVoltage;

                const frontWheelRPM = motorRPM / this.results.finalFrontRatio;
                const rearWheelRPM = motorRPM / this.results.finalRearRatio;

                const frontSpeedMPH = (frontWheelRPM * tireCircumference * 60) / (12 * 5280);
                const rearSpeedMPH = (rearWheelRPM * tireCircumference * 60) / (12 * 5280);

                this.results.frontSpeed = frontSpeedMPH;
                this.results.rearSpeed = rearSpeedMPH;

                return this.results;
            }

            calculateAll(params) {
                this.calculateRatios(params);
                this.calculateSpeeds(params);
                return this.results;
            }

            getFormattedResults() {
                return {
                    motorRatio: this.formatRatio(this.results.motorRatio),
                    finalFrontRatio: this.formatRatio(this.results.finalFrontRatio),
                    finalRearRatio: this.formatRatio(this.results.finalRearRatio),
                    frontSpeed: this.formatSpeed(this.results.frontSpeed),
                    rearSpeed: this.formatSpeed(this.results.rearSpeed),
                    overdrivePercentage: this.formatPercentage(this.results.overdrivePercentage)
                };
            }

            formatRatio(ratio) {
                if (!ratio || ratio === 0) return '-';
                return `${ratio.toFixed(3)}:1`;
            }

            formatSpeed(speed) {
                if (!speed || speed === 0) return '-';
                return `${speed.toFixed(2)} MPH`;
            }

            formatPercentage(percentage) {
                if (!isFinite(percentage)) return '-';
                const sign = percentage > 0 ? '+' : '';
                return `${sign}${percentage.toFixed(1)}%`;
            }
        }

        // Global calculator instance
        const calculator = new CrawlerCalculator();

        // UI Functions
        function populateTransmissions() {
            const select = document.getElementById('transmission');
            if (!select) return;
            
            const transmissions = getTransmissionNames();
            
            transmissions.forEach(transmission => {
                const option = document.createElement('option');
                option.value = transmission;
                option.textContent = transmission;
                select.appendChild(option);
            });
        }

        function populateAxles() {
            const frontSelect = document.getElementById('frontAxle');
            const rearSelect = document.getElementById('rearAxle');
            
            if (!frontSelect || !rearSelect) return;
            
            const axles = getAxleNames();
            
            axles.forEach(axle => {
                const frontOption = document.createElement('option');
                frontOption.value = axle;
                frontOption.textContent = axle;
                frontSelect.appendChild(frontOption);
                
                const rearOption = document.createElement('option');
                rearOption.value = axle;
                rearOption.textContent = axle;
                rearSelect.appendChild(rearOption);
            });
        }

        function setDefaults() {
            const transmissionEl = document.getElementById('transmission');
            if (transmissionEl) {
                transmissionEl.value = 'Axial 3-Gear';
            }
            
            const frontAxleEl = document.getElementById('frontAxle');
            if (frontAxleEl) {
                frontAxleEl.value = 'AR44 / AR45 / SCX Pro / Element';
            }
            
            const rearAxleEl = document.getElementById('rearAxle');
            if (rearAxleEl) {
                rearAxleEl.value = 'AR44 / AR45 / SCX Pro / Element';
            }
        }

        function calculate() {
            try {
                const params = {
                    spurTeeth: parseFloat(document.getElementById('spur').value) || 0,
                    pinionTeeth: parseFloat(document.getElementById('pinion').value) || 0,
                    transmissionName: document.getElementById('transmission').value,
                    frontAxleName: document.getElementById('frontAxle').value,
                    rearAxleName: document.getElementById('rearAxle').value,
                    reverseTransmission: document.getElementById('reverseTransmission').checked,
                    motorKV: parseFloat(document.getElementById('motorKV').value) || 0,
                    maxVoltage: parseFloat(document.getElementById('maxVoltage').value) || 0,
                    tireSize: parseFloat(document.getElementById('tireSize').value) || 0,
                    tireSizeUnit: document.getElementById('tireSizeUnit').value
                };
                
                const results = calculator.calculateAll(params);
                const formatted = calculator.getFormattedResults();
                
                const transmission = getTransmission(params.transmissionName);
                const frontAxleRatio = getAxle(params.frontAxleName);
                const rearAxleRatio = getAxle(params.rearAxleName);
                
                updateElement('motorRatio', formatted.motorRatio);
                updateTransmissionRatio(transmission, params.reverseTransmission);
                updateElement('frontAxleRatio', frontAxleRatio ? `${frontAxleRatio.toFixed(3)}:1` : '-');
                updateElement('rearAxleRatio', rearAxleRatio ? `${rearAxleRatio.toFixed(3)}:1` : '-');
                updateElement('frontRatio', formatted.finalFrontRatio);
                updateElement('rearRatio', formatted.finalRearRatio);
                updateElement('overdrivePercentage', formatted.overdrivePercentage);
                updateElement('frontSpeed', formatted.frontSpeed);
                updateElement('rearSpeed', formatted.rearSpeed);
                
            } catch (error) {
                console.error('Calculation error:', error);
            }
        }

        function updateTransmissionRatio(transmission, reverseTransmission) {
            const transmissionRatioEl = document.getElementById('transmissionRatio');
            if (!transmissionRatioEl) return;
            
            if (!transmission) {
                transmissionRatioEl.textContent = '-';
                return;
            }
            
            const frontTransRatio = reverseTransmission ? transmission.rear : transmission.front;
            const rearTransRatio = reverseTransmission ? transmission.front : transmission.rear;
            
            if (frontTransRatio === rearTransRatio) {
                transmissionRatioEl.textContent = `${frontTransRatio.toFixed(3)}:1`;
            } else {
                transmissionRatioEl.textContent = `F:${frontTransRatio.toFixed(3)} R:${rearTransRatio.toFixed(3)}`;
            }
        }

        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }

        let debounceTimer = null;
        function debounceCalculate() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(calculate, 300);
        }

        function copyToClipboard(element) {
            const valueElement = element.querySelector('.value');
            
            if (!valueElement) return;
            
            let value = valueElement.textContent.trim();
            
            if (!value || value === '-') {
                showCopyFeedback(element, 'No value to copy', 'error');
                return;
            }
            
            if (value.includes(':1')) {
                value = value.split(':1')[0];
            } else {
                const numberMatch = value.match(/[\d,.]+/);
                if (numberMatch) {
                    value = numberMatch[0];
                }
            }
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(value).then(() => {
                    showCopyFeedback(element, 'Copied!', 'success');
                }).catch(() => {
                    fallbackCopyToClipboard(value, element);
                });
            } else {
                fallbackCopyToClipboard(value, element);
            }
        }

        function fallbackCopyToClipboard(text, element) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopyFeedback(element, 'Copied!', 'success');
                } else {
                    showCopyFeedback(element, 'Copy failed', 'error');
                }
            } catch (err) {
                showCopyFeedback(element, 'Copy not supported', 'error');
            }
            
            document.body.removeChild(textArea);
        }

        function showCopyFeedback(element, message, type) {
            element.classList.add('copied');
            
            const feedback = document.createElement('div');
            feedback.textContent = message;
            feedback.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: ${type === 'success' ? '#4CAF50' : '#f44336'};
                color: white;
                padding: 8px 16px;
                border-radius: 4px;
                font-size: 14px;
                font-weight: bold;
                z-index: 1000;
                pointer-events: none;
                animation: fadeInOut 1.5s ease-out forwards;
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                    20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                }
            `;
            document.head.appendChild(style);
            
            element.style.position = 'relative';
            element.appendChild(feedback);
            
            setTimeout(() => {
                element.classList.remove('copied');
                if (feedback.parentNode) {
                    feedback.parentNode.removeChild(feedback);
                }
                document.head.removeChild(style);
            }, 1500);
        }

        // Export functionality
        function exportConfiguration() {
            try {
                const config = getFormConfiguration();
                const results = calculator.calculateAll({
                    spurTeeth: parseFloat(config.spur) || 0,
                    pinionTeeth: parseFloat(config.pinion) || 0,
                    transmissionName: config.transmission,
                    frontAxleName: config.frontAxle,
                    rearAxleName: config.rearAxle,
                    reverseTransmission: config.reverseTransmission,
                    motorKV: parseFloat(config.motorKV) || 0,
                    maxVoltage: parseFloat(config.maxVoltage) || 0,
                    tireSize: parseFloat(config.tireSize) || 0,
                    tireSizeUnit: config.tireSizeUnit
                });
                
                const content = createExportContent(config, results);
                downloadFile(content, `crawler-config-${new Date().toISOString().slice(0, 10)}.txt`);
                
                showExportFeedback();
                
            } catch (error) {
                console.error('Export error:', error);
                alert('Error exporting configuration. Please try again.');
            }
        }

        function getFormConfiguration() {
            const getElementValue = (id, defaultValue = '') => {
                const element = document.getElementById(id);
                return element ? element.value : defaultValue;
            };
            
            const getElementChecked = (id, defaultValue = false) => {
                const element = document.getElementById(id);
                return element ? element.checked : defaultValue;
            };
            
            return {
                pinion: getElementValue('pinion'),
                spur: getElementValue('spur'),
                transmission: getElementValue('transmission'),
                frontAxle: getElementValue('frontAxle'),
                rearAxle: getElementValue('rearAxle'),
                reverseTransmission: getElementChecked('reverseTransmission'),
                motorKV: getElementValue('motorKV'),
                voltagePreset: getElementValue('voltagePreset'),
                maxVoltage: getElementValue('maxVoltage'),
                tireSize: getElementValue('tireSize'),
                tireSizeUnit: getElementValue('tireSizeUnit')
            };
        }

        function createExportContent(config, results) {
            const timestamp = new Date().toLocaleString();
            const formatted = calculator.getFormattedResults();
            
            let voltagePresetText = 'Custom';
            const voltagePresetEl = document.getElementById('voltagePreset');
            if (voltagePresetEl && voltagePresetEl.selectedIndex >= 0) {
                const selectedOption = voltagePresetEl.options[voltagePresetEl.selectedIndex];
                if (selectedOption && selectedOption.text && config.voltagePreset) {
                    voltagePresetText = selectedOption.text;
                }
            }
            
            return `===============================================
         RC CRAWLER GEAR RATIO CALCULATOR
                 ydrRC Configuration
===============================================
Export Date: ${timestamp}

DRIVETRAIN CONFIGURATION:
========================
Pinion Gear:           ${config.pinion} teeth
Spur Gear:             ${config.spur} teeth
Transmission:          ${config.transmission}
Front Axle:            ${config.frontAxle}
Rear Axle:             ${config.rearAxle}
Reverse Transmission:  ${config.reverseTransmission ? 'YES' : 'NO'}

POWER SYSTEM:
=============
Motor KV:              ${config.motorKV}
Voltage Preset:        ${voltagePresetText}
Max Voltage:           ${config.maxVoltage}V
Tire Size:             ${config.tireSize} ${config.tireSizeUnit}

CALCULATED RESULTS:
==================
Motor Gear Ratio:      ${formatted.motorRatio}
Final Front Ratio:     ${formatted.finalFrontRatio}
Final Rear Ratio:      ${formatted.finalRearRatio}
Overdrive Percentage:  ${formatted.overdrivePercentage}
Approx. Front Speed:   ${formatted.frontSpeed}
Approx. Rear Speed:    ${formatted.rearSpeed}

CONFIGURATION DATA (DO NOT EDIT):
=================================
CONFIG_START
pinion=${config.pinion}
spur=${config.spur}
transmission=${config.transmission}
frontAxle=${config.frontAxle}
rearAxle=${config.rearAxle}
reverseTransmission=${config.reverseTransmission}
motorKV=${config.motorKV}
voltagePreset=${config.voltagePreset}
maxVoltage=${config.maxVoltage}
tireSize=${config.tireSize}
tireSizeUnit=${config.tireSizeUnit}
CONFIG_END

===============================================
Generated by ydrRC Crawler Calculator
===============================================`;
        }

        function downloadFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showExportFeedback() {
            const exportBtn = document.getElementById('exportBtn');
            if (exportBtn) {
                const originalText = exportBtn.textContent;
                exportBtn.textContent = 'Exported!';
                exportBtn.style.backgroundColor = '#28a745';
                setTimeout(() => {
                    exportBtn.textContent = originalText;
                    exportBtn.style.backgroundColor = '#000000';
                }, 2000);
            }
        }

        // Import functionality
        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const config = parseImportContent(content);
                    
                    if (config && Object.keys(config).length > 0) {
                        applyImportedConfig(config);
                        showImportFeedback('Configuration imported successfully!', 'success');
                        setTimeout(calculate, 100);
                    } else {
                        showImportFeedback('Could not find valid configuration data in file', 'error');
                    }
                } catch (error) {
                    console.error('Import error:', error);
                    showImportFeedback('Error: ' + error.message, 'error');
                }
                
                event.target.value = '';
            };
            
            reader.onerror = function() {
                showImportFeedback('Failed to read file', 'error');
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }

        function parseImportContent(content) {
            const configStart = content.indexOf('CONFIG_START');
            const configEnd = content.indexOf('CONFIG_END');
            
            if (configStart === -1 || configEnd === -1) {
                return null;
            }
            
            const configSection = content.substring(configStart + 12, configEnd).trim();
            const config = {};
            const lines = configSection.split('\n');
            
            for (const line of lines) {
                const trimmed = line.trim();
                if (trimmed && trimmed.includes('=')) {
                    const equalPos = trimmed.indexOf('=');
                    const key = trimmed.substring(0, equalPos).trim();
                    const value = trimmed.substring(equalPos + 1).trim();
                    
                    if (key) {
                        if (value === 'true') {
                            config[key] = true;
                        } else if (value === 'false') {
                            config[key] = false;
                        } else {
                            config[key] = value;
                        }
                    }
                }
            }
            
            return config;
        }

        function applyImportedConfig(config) {
            const setValue = (id, value) => {
                const element = document.getElementById(id);
                if (element && value !== undefined && value !== null && value !== '') {
                    element.value = value;
                    return true;
                }
                return false;
            };
            
            const setChecked = (id, checked) => {
                const element = document.getElementById(id);
                if (element && checked !== undefined && checked !== null) {
                    element.checked = checked;
                    return true;
                }
                return false;
            };
            
            setValue('pinion', config.pinion);
            setValue('spur', config.spur);
            setValue('transmission', config.transmission);
            setValue('frontAxle', config.frontAxle);
            setValue('rearAxle', config.rearAxle);
            setChecked('reverseTransmission', config.reverseTransmission);
            setValue('motorKV', config.motorKV);
            setValue('voltagePreset', config.voltagePreset);
            setValue('maxVoltage', config.maxVoltage);
            setValue('tireSize', config.tireSize);
            setValue('tireSizeUnit', config.tireSizeUnit);
            
            const voltagePreset = document.getElementById('voltagePreset');
            const maxVoltage = document.getElementById('maxVoltage');
            
            if (voltagePreset && maxVoltage) {
                if (config.voltagePreset && config.voltagePreset !== '') {
                    maxVoltage.disabled = true;
                    maxVoltage.style.backgroundColor = '#e9ecef';
                    maxVoltage.style.cursor = 'not-allowed';
                } else {
                    maxVoltage.disabled = false;
                    maxVoltage.style.backgroundColor = 'white';
                    maxVoltage.style.cursor = 'text';
                }
            }
        }

        function showImportFeedback(message, type) {
            const feedback = document.createElement('div');
            feedback.textContent = message;
            feedback.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : '#f44336'};
                color: white;
                padding: 15px 20px;
                border-radius: 4px;
                font-size: 14px;
                font-weight: bold;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                if (feedback.parentNode) feedback.parentNode.removeChild(feedback);
            }, 3000);
        }

        function addEventListeners() {
            const inputs = [
                'pinion', 'spur', 'transmission', 'frontAxle', 'rearAxle', 
                'reverseTransmission', 'motorKV', 'maxVoltage', 'tireSize', 'tireSizeUnit'
            ];
            
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', calculate);
                    if (element.type !== 'select-one' && element.type !== 'checkbox') {
                        element.addEventListener('input', debounceCalculate);
                    }
                }
            });
            
            const exportBtn = document.getElementById('exportBtn');
            if (exportBtn) {
                exportBtn.addEventListener('click', exportConfiguration);
            }
            
            const importFile = document.getElementById('importFile');
            if (importFile) {
                importFile.addEventListener('change', handleImportFile);
            }
            
            const voltagePresetEl = document.getElementById('voltagePreset');
            const maxVoltageEl = document.getElementById('maxVoltage');
            
            if (voltagePresetEl && maxVoltageEl) {
                voltagePresetEl.addEventListener('change', function() {
                    if (this.value) {
                        maxVoltageEl.value = this.value;
                        maxVoltageEl.disabled = true;
                        maxVoltageEl.style.backgroundColor = '#e9ecef';
                        maxVoltageEl.style.cursor = 'not-allowed';
                    } else {
                        maxVoltageEl.disabled = false;
                        maxVoltageEl.style.backgroundColor = 'white';
                        maxVoltageEl.style.cursor = 'text';
                    }
                    calculate();
                });
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, starting initialization...');
            
            try {
                // Update version display first
                updateVersionDisplay();
                
                populateTransmissions();
                populateAxles();
                
                setTimeout(() => {
                    setDefaults();
                    calculate();
                }, 100);
                
                addEventListeners();
                
                console.log('Initialization complete');
            } catch (error) {
                console.error('Initialization error:', error);
                alert('Failed to initialize calculator. Please refresh the page.');
            }
        });
    </script>
</body>
</html>